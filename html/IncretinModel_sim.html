
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Code for the beta-cell insulin secretion model incorporating the incretin effect</title><meta name="generator" content="MATLAB 8.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-03-04"><meta name="DC.source" content="IncretinModel_sim.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Code for the beta-cell insulin secretion model incorporating the incretin effect</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">Parameters initialization</a></li><li><a href="#3">- Study A1: GIP or GLP1 infusion at basal glucose - NGT subjects</a></li><li><a href="#4">- Study A2: saline, GIP or GLP1 infusion at basal glucose - T2D subjects</a></li><li><a href="#5">- Study B1: hiperglycemic clamp (HGC) with saline, GIP infusion or GLP1 infusion at different doses - NGT subjects</a></li><li><a href="#6">- Study B1: hiperglycemic clamp (HGC) with saline, GIP infusion or GLP1 infusion at different doses - T2D subjects</a></li><li><a href="#7">- Study B2: hyperglicaemic clamp (HGC) with saline, GIP or GLP1 infusion - NGT subjects</a></li><li><a href="#8">- Study B2: hyperglicaemic clamp (HGC) with saline, GIP or GLP1 infusion - T2D subjects (pre glucose normalization)</a></li><li><a href="#9">- Study B2: plot cpeptide</a></li><li><a href="#10">- Study B3: hiperglycemic clamp (HGC) with saline or GIP infusion - NGT subjects</a></li><li><a href="#11">- Study B3: hiperglycemic clamp (HGC) with saline, GIP infusion at different doses or GLP1 infusion - T2D subjects</a></li><li><a href="#12">- Study B4: hyperglicaemic clamp (HGC) with boluses and infusion of GIP at different doses - NGT subjects</a></li><li><a href="#13">- Study B4: hyperglicaemic clamp (HGC) with boluses and infusion of GIP at different doses - T2D subjects</a></li><li><a href="#14">- Study C1: glucose ramp with saline infusion or GLP1 infusion at different doses - NGT subjects</a></li><li><a href="#15">- Study C1: glucose ramp with saline infusion or GLP1 infusion at different doses - T2D subjects</a></li><li><a href="#16">- Study D1: OGTT and Intravenous glucose infusion simulating an OGTT with saline, GIP or GLP1 infusion - NGT subjects</a></li><li><a href="#19">Data analysis</a></li></ul></div><pre class="codeinput">addpath(genpath(<span class="string">'model_functions'</span>))
</pre><h2>Parameters initialization<a name="2"></a></h2><p>The parameters are the result of the fit to the experimental data (see below for the list of publications).</p><p>Each dataset (related to a specific experimental condition) and the corresponding reference parameter vector are saved in a different file .mat.</p><p>Each element of the p vector correspond to a parameter in the equations of the article: p(1)--&gt; p6 in the equation of the article p(2)--&gt; p7 in the equation of the article p(3)--&gt; p8 in the equation of the article p(4)--&gt; p9 in the equation of the article p(5)--&gt; p10 in the equation of the article p(6)--&gt; p11 in the equation of the article p(7)--&gt; Parameter not used p(8)--&gt; p5 in the equation of the article p(9)--&gt; p1 in the equation of the article p(10)--&gt; p2 in the equation of the article p(11)--&gt; p3 in the equation of the article p(12)--&gt; p4 in the equation of the article p(13)--&gt; p15 in the equation of the article p(14)--&gt; p14 in the equation of the article p(15)--&gt; p12 in the equation of the article p(16)--&gt; p13 in the equation of the article p(17)--&gt; p21 in the equation of the article p(18)--&gt; p22 in the equation of the article p(19)--&gt; p23 in the equation of the article p(20)--&gt; p24 in the equation of the article p(21)--&gt; p16 in the equation of the article p(22)--&gt; p17 in the equation of the article p(23)--&gt; p18 in the equation of the article</p><pre class="codeinput"><span class="comment">% The vector p_peak is held fixed</span>
<span class="comment">% p_peak(1)--&gt; p19 in the equation of the article</span>
<span class="comment">% p_peak(2)--&gt; p20 in the equation of the article</span>
</pre><h2>- Study A1: GIP or GLP1 infusion at basal glucose - NGT subjects<a name="3"></a></h2><p>Data from Honka et al., 2018</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Honka/Honka</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    camod(k)=casim(glu(k),pca);
<span class="keyword">end</span>

<span class="comment">% Add to calcium the transient increse due to the GIP or GLP-1</span>
<span class="comment">% GIP infusion (2 pmol/kg/min), GLP-1 infusion (0.75 pmol/kg/min)</span>
camod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    camod_IE(k).t=camod(k).t;
    camod_IE(k).v=camod(k).v+ca_transient(k).v;  <span class="comment">% calcium with incretins</span>
<span class="keyword">end</span>

<span class="comment">% Simulate secretion with the contribution of the incretin effect</span>
secmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
secmod_IE(k)=secsim_IE(p,camod_IE(k),glu(k),Kincr(k));
<span class="keyword">end</span>

<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>


subplot(4,1,1)
plot(glu(1).t,glu(1).v,<span class="string">'--b'</span>,glu(2).t,glu(2).v,<span class="string">'--r'</span>)
setAxes(-10, 80, 10, <span class="string">''</span>, 3, 6, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod_IE(1).t,camod_IE(1).v,<span class="string">'b'</span>,camod_IE(2).t,camod_IE(2).v,<span class="string">'r'</span>)
setAxes(-10, 80, 10, <span class="string">''</span>, 50, 150, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(Kincr(1).t,Kincr(1).v,<span class="string">'b'</span>,Kincr(2).t,Kincr(2).v,<span class="string">'r'</span>)
setAxes(-10, 80, 10, <span class="string">''</span>, 1, 5, 5, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(sec(1).t,sec(1).v,<span class="string">'--b'</span>,secmod_IE(1).t,secmod_IE(1).v/BSA,<span class="string">'b'</span>,<span class="keyword">...</span>
    sec(2).t,sec(2).v,<span class="string">'--r'</span>,secmod_IE(2).t,secmod_IE(2).v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-10, 80, 10, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 300, 3, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'GIP data'</span>,<span class="string">'GIP model'</span>,<span class="string">'GLP-1 data'</span>,<span class="string">'GLP-1 model'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_01.png" style="width:560px;height:420px;" alt=""> <h2>- Study A2: saline, GIP or GLP1 infusion at basal glucose - T2D subjects<a name="4"></a></h2><p>Data from Mentis et al., 2010</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Mentis/Mentis</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=casim(glu(1),pca); <span class="comment">% calcium without incretins</span>
<span class="comment">% Simulate calcium - GIP infusion low dose (4 pmol/kg/min), GIP infusion</span>
<span class="comment">% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)</span>
camod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
catmp=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    catmp(k)=casim(glu(k+1),pca);
    camod_IE(k).t=catmp(k).t;
    camod_IE(k).v=catmp(k).v+ca_transient.v; <span class="comment">% calcium with incretins</span>
<span class="keyword">end</span>



<span class="comment">% Simulate secretion - saline infusion</span>
secmod=secsim_IE(p,camod,glu(1),Kglu);<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>

<span class="comment">% Simulate secretion with the contribution of the incretin effect</span>
<span class="comment">% GIP infusion low dose (4 pmol/kg/min), GIP infusion</span>
<span class="comment">% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)</span>
Kincr_glu=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v;
<span class="keyword">end</span>     <span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
secmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu(k+1),Kincr_glu(k));
<span class="keyword">end</span>

<span class="comment">% Calculate cpeptide</span>
[pcp,~,~]=vancau(<span class="string">'T2D'</span>,<span class="string">'M'</span>,age,weight,height);

<span class="comment">% cpeptide - saline infusion</span>
cpepmod=cpepsim(pcp,glu(1).t,secmod);
<span class="comment">% cpeptide - GIP infusion low dose (4 pmol/kg/min), GIP infusion</span>
<span class="comment">% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)</span>
cpepmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    cpepmod_IE(k)=cpepsim(pcp,glu(k).t,secmod_IE(k));
<span class="keyword">end</span>


<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>


subplot(4,1,1)
plot(glu(1).t,glu(1).v,<span class="string">'--k'</span>,glu(2).t,glu(2).v,<span class="string">'--b'</span>,glu(3).t,glu(3).v,<span class="string">'--r'</span>)
setAxes(0, 240, 50, <span class="string">''</span>, 5, 20, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>,camod_IE(1).t,camod_IE(1).v,<span class="string">'b'</span>,camod_IE(2).t,camod_IE(2).v,<span class="string">'r'</span>)
setAxes(0, 240, 10, <span class="string">''</span>, 50, 450, 5, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu(1).t,ones(1,numel(glu(1).t)),<span class="string">'k'</span>,Kincr(1).t,Kincr(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    Kincr(2).t,Kincr(2).v,<span class="string">'r'</span>)
setAxes(0, 240,10, <span class="string">''</span>, 1, 8, 8, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,<span class="string">'k'</span>,secmod_IE(1).t,secmod_IE(1).v/BSA,<span class="string">'b'</span>,<span class="keyword">...</span>
    secmod_IE(2).t,secmod_IE(2).v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(0, 360, 7, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 600, 5, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline model'</span>,<span class="string">'GIP model'</span>,<span class="string">'GLP1 model'</span>)



figure()
plot(cpep(1).t,cpep(1).v,<span class="string">'--k'</span>,cpepmod.t,cpepmod.v,<span class="string">'k'</span>,<span class="keyword">...</span>
    cpep(2).t,cpep(2).v,<span class="string">'--b'</span>,cpepmod_IE(1).t,cpepmod_IE(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    cpep(3).t,cpep(3).v,<span class="string">'--r'</span>,cpepmod_IE(2).t,cpepmod_IE(2).v,<span class="string">'r'</span>);
setAxes(0, 360, 7, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    800, 1800, 6, <span class="string">'C-peptide (pmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline data'</span>,<span class="string">'saline model'</span>,<span class="string">'GIP data'</span>,<span class="string">'GIP model'</span>,<span class="string">'GLP1 data'</span>,<span class="string">'GLP1 model'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_02.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_03.png" style="width:560px;height:420px;" alt=""> <h2>- Study B1: hiperglycemic clamp (HGC) with saline, GIP infusion or GLP1 infusion at different doses - NGT subjects<a name="5"></a></h2><p>Data from Nauck et al., JCI 1993</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">NauckJCI/NauckJCI_NGT</span>


<span class="comment">% Simulate calcium - saline infusion</span>
pca=[p_peak;p(17:23)];<span class="comment">% calcium parameter</span>
camod=casim(glu,pca);
<span class="comment">% Simulate calcium - GIP and GLP1 infusion</span>
camod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
<span class="keyword">end</span>

<span class="comment">% Simulate secretion - saline infusion</span>
secmod=secsim_IE(p,camod,glu,Kglu);<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>

<span class="comment">% Simulate secretion with the contribution of GIP or GLP1 infusion</span>
Kincr_glu=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v;
<span class="keyword">end</span>     <span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
secmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu,Kincr_glu(k));
<span class="keyword">end</span>

<span class="comment">% Calculate cpeptide</span>
[pcp,~,~]=vancau(<span class="string">'ND'</span>,<span class="string">'M'</span>,age,weight,height);

<span class="comment">% cpeptide - saline infusion</span>
cpepmod=cpepsim(pcp,cpep(1).t,secmod);
<span class="comment">% cpeptide - GIP infusion low dose (4 pmol/kg/min), GIP infusion</span>
<span class="comment">% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)</span>
cpepmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    cpepmod_IE(k)=cpepsim(pcp,cpep(k+1).t,secmod_IE(k));
<span class="keyword">end</span>

<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>


subplot(4,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-20, 120, 8, <span class="string">''</span>, 5, 10, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>,camod_IE(1).t,camod_IE(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    camod_IE(2).t,camod_IE(2).v,<span class="string">'r'</span>)
setAxes(-20, 120, 8, <span class="string">''</span>, 50, 350, 4, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),<span class="string">'k'</span>,Kincr(1).t,Kincr(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    Kincr(2).t,Kincr(2).v,<span class="string">'r'</span>)
setAxes(-20, 120,8, <span class="string">''</span>, 1, 10, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,<span class="string">'k'</span>,secmod_IE(1).t,secmod_IE(1).v/BSA,<span class="string">'b'</span>,<span class="keyword">...</span>
    secmod_IE(2).t,secmod_IE(2).v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-30, 120, 6, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 1500, 4, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline model'</span>,<span class="string">'GIP model'</span>,<span class="string">'GLP1 model'</span>)


<span class="comment">% Plot cpeptide</span>
figure()
plot(cpep(1).t,cpep(1).v*1000,<span class="string">'--k'</span>,cpepmod.t,cpepmod.v,<span class="string">'k'</span>,<span class="keyword">...</span><span class="comment">     % *1000 to express in pmol/L</span>
    cpep(2).t,cpep(2).v*1000,<span class="string">'--b'</span>,cpepmod_IE(1).t,cpepmod_IE(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    cpep(3).t,cpep(3).v*1000,<span class="string">'--r'</span>,cpepmod_IE(2).t,cpepmod_IE(2).v,<span class="string">'r'</span>);
setAxes(-30, 120, 6, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 8000, 5, <span class="string">'C-peptide (pmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline data'</span>,<span class="string">'saline model'</span>,<span class="string">'GIP data'</span>,<span class="string">'GIP model'</span>,<span class="string">'GLP1 data'</span>,<span class="string">'GLP1 model'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_04.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_05.png" style="width:560px;height:420px;" alt=""> <h2>- Study B1: hiperglycemic clamp (HGC) with saline, GIP infusion or GLP1 infusion at different doses - T2D subjects<a name="6"></a></h2><p>Data from Nauck et al., JCI 1993</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">NauckJCI/NauckJCI_T2D</span>


<span class="comment">% Simulate calcium - saline infusion</span>
pca=[p_peak;p(17:23)];<span class="comment">% calcium parameter</span>
camod=casim(glu,pca);
<span class="comment">% Simulate calcium - GIP and GLP1 infusion</span>
camod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
<span class="keyword">end</span>

<span class="comment">% Simulate secretion - saline infusion</span>
secmod=secsim_IE(p,camod,glu,Kglu);<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>

<span class="comment">% Simulate secretion with the contribution of GIP or GLP1 infusion</span>
Kincr_glu=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v;
<span class="keyword">end</span>     <span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
secmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu,Kincr_glu(k));
<span class="keyword">end</span>

<span class="comment">% Calculate cpeptide</span>
[pcp,~,~]=vancau(<span class="string">'T2D'</span>,<span class="string">'M'</span>,age,weight,height);

<span class="comment">% cpeptide - saline infusion</span>
cpepmod=cpepsim(pcp,cpep(1).t,secmod);
<span class="comment">% cpeptide - GIP infusion low dose (4 pmol/kg/min), GIP infusion</span>
<span class="comment">% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)</span>
cpepmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    cpepmod_IE(k)=cpepsim(pcp,cpep(k+1).t,secmod_IE(k));
<span class="keyword">end</span>

<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>


subplot(4,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-20, 120, 8, <span class="string">''</span>, 5, 10, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>,camod_IE(1).t,camod_IE(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    camod_IE(2).t,camod_IE(2).v,<span class="string">'r'</span>)
setAxes(-20, 120, 8, <span class="string">''</span>, 50, 350, 4, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),<span class="string">'k'</span>,Kincr(1).t,Kincr(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    Kincr(2).t,Kincr(2).v,<span class="string">'r'</span>)
setAxes(-20, 120,8, <span class="string">''</span>, 1, 10, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,<span class="string">'k'</span>,secmod_IE(1).t,secmod_IE(1).v/BSA,<span class="string">'b'</span>,<span class="keyword">...</span>
    secmod_IE(2).t,secmod_IE(2).v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-30, 120, 6, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 1500, 4, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline model'</span>,<span class="string">'GIP model'</span>,<span class="string">'GLP1 model'</span>)

<span class="comment">% Plot cpeptide</span>
figure()
plot(cpep(1).t,cpep(1).v*1000,<span class="string">'--k'</span>,cpepmod.t,cpepmod.v,<span class="string">'k'</span>,<span class="keyword">...</span><span class="comment">   % *1000 to express in pmol/L</span>
    cpep(2).t,cpep(2).v*1000,<span class="string">'--b'</span>,cpepmod_IE(1).t,cpepmod_IE(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    cpep(3).t,cpep(3).v*1000,<span class="string">'--r'</span>,cpepmod_IE(2).t,cpepmod_IE(2).v,<span class="string">'r'</span>);
setAxes(-30, 120, 6, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 8000, 5, <span class="string">'C-peptide (pmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline data'</span>,<span class="string">'saline model'</span>,<span class="string">'GIP data'</span>,<span class="string">'GIP model'</span>,<span class="string">'GLP1 data'</span>,<span class="string">'GLP1 model'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_06.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_07.png" style="width:560px;height:420px;" alt=""> <h2>- Study B2: hyperglicaemic clamp (HGC) with saline, GIP or GLP1 infusion - NGT subjects<a name="7"></a></h2><p>Data from Hojberg et al., 2009</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Hojberg/Hojberg_NGT</span>


<span class="comment">% Calculate calcium from glucose - saline infusion</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=casim(glu,pca);  <span class="comment">% calcium with saline infusiomn</span>
<span class="comment">% Calculate calcium from glucose and GIP or GLP1 infusion</span>
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;

<span class="comment">% Simulate secretion with saline infusion</span>
secmod=secsim_IE(p,camod,glu,Kglu);<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>

<span class="comment">% Simulate secretion with the contribution of the incretin effect</span>
Kincr_glu=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
<span class="keyword">for</span> k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v;
<span class="keyword">end</span>
secmod_IE=secsim_IE(p,camod_IE,glu,Kincr_glu(1),p,camod_IE,glu,Kincr_glu(2));

<span class="comment">% Calculate cpeptide from secmod_IE</span>
[pcp,~,~]=vancau(<span class="string">'ND'</span>,<span class="string">'M'</span>,age,weight,height);

cpepmod=cpepsim(pcp,glu.t,secmod);
cpepmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    cpepmod_IE(k)=cpepsim(pcp,glu.t,secmod_IE(k));
<span class="keyword">end</span>


<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>


subplot(4,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-15, 110, 9, <span class="string">''</span>, 5, 20, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>,camod_IE.t,camod_IE.v,<span class="string">'b'</span>)
setAxes(-15, 110, 9, <span class="string">''</span>, 50, 400, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),<span class="string">'k'</span>,Kincr(1).t,Kincr(1).v,<span class="string">'b'</span>,Kincr(2).t,Kincr(2).v,<span class="string">'b'</span>)
setAxes(-15, 110, 9, <span class="string">''</span>, 1, 2, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,<span class="string">'k'</span>,secmod_IE(1).t,secmod_IE(1).v/BSA,<span class="string">'r'</span>,secmod_IE(2).t,secmod_IE(2).v/BSA,<span class="string">'b'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-15, 105, 9, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 1800, 7, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline'</span>,<span class="string">'GIP'</span>,<span class="string">'GLP-1'</span>)
title(<span class="string">'NGT'</span>)


cpep_NGT(1)=cpep(1);
cpep_NGT(2)=cpep(2);
cpep_NGT(3)=cpep(3);
cpepmod_NGT(1)=cpepmod;
cpepmod_NGT(2)=cpepmod_IE(1);
cpepmod_NGT(3)=cpepmod_IE(2);
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_08.png" style="width:560px;height:420px;" alt=""> <h2>- Study B2: hyperglicaemic clamp (HGC) with saline, GIP or GLP1 infusion - T2D subjects (pre glucose normalization)<a name="8"></a></h2><p>Data from Hojberg et al., 2009</p><pre class="codeinput"><span class="comment">%clear all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Hojberg/Hojberg_T2D_pre</span>


<span class="comment">% Calculate calcium from glucose - saline infusion</span>
pca=[p_peak;p(17:23,1)]; <span class="comment">% calcium parameter</span>
camod=casim(glu,pca);  <span class="comment">% calcium with saline infusiomn</span>
<span class="comment">% Calculate calcium from glucose and GIP or GLP1 infusion</span>
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;

<span class="comment">% Simulate secretion with saline infusion</span>
secmod=secsim_IE(p(:,1),camod,glu,Kglu);<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>

<span class="comment">% Simulate secretion with the contribution of the incretin effect</span>
Kincr_glu=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
<span class="keyword">for</span> k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v;
<span class="keyword">end</span>
secmod_IE=secsim_IE(p(:,2),camod_IE,glu,Kincr_glu(1),p(:,3),camod_IE,glu,Kincr_glu(2));

<span class="comment">% Calculate cpeptide from secmod_IE</span>
[pcp,~,~]=vancau(<span class="string">'T2D'</span>,<span class="string">'M'</span>,age,weight,height);

cpepmod=cpepsim(pcp,glu.t,secmod);
cpepmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{}); <span class="comment">% calcium with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)</span>
<span class="keyword">for</span> k=1:2
    cpepmod_IE(k)=cpepsim(pcp,glu.t,secmod_IE(k));
<span class="keyword">end</span>


<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>


subplot(4,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-15, 110, 9, <span class="string">''</span>, 10, 20, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>,camod_IE.t,camod_IE.v,<span class="string">'r'</span>)
setAxes(-15, 110, 9, <span class="string">''</span>, 50, 350, 4, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),<span class="string">'k'</span>,Kincr(1).t,Kincr(1).v,<span class="string">'b'</span>,Kincr(2).t,Kincr(2).v,<span class="string">'r'</span>)
setAxes(-15, 110, 9, <span class="string">''</span>, 1, 2, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,<span class="string">'k'</span>,secmod_IE(1).t,secmod_IE(1).v/BSA,<span class="string">'b'</span>,secmod_IE(2).t,secmod_IE(2).v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-15, 105, 9, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 300, 3, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline'</span>,<span class="string">'GIP'</span>,<span class="string">'GLP-1'</span>)
title(<span class="string">'T2D'</span>)


cpep_T2Dpre(1)=cpep(1);
cpep_T2Dpre(2)=cpep(2);
cpep_T2Dpre(3)=cpep(3);
cpepmod_T2Dpre(1)=cpepmod;
cpepmod_T2Dpre(2)=cpepmod_IE(1);
cpepmod_T2Dpre(3)=cpepmod_IE(2);
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_09.png" style="width:560px;height:420px;" alt=""> <h2>- Study B2: plot cpeptide<a name="9"></a></h2><pre class="codeinput">figure()
set(gcf,<span class="string">'position'</span>, [250 250 800 400])
subplot(1,3,1)
<span class="comment">%Plot cpeptide - saline infusion in NGT and T2D pre glucose normalization</span>
plot(cpep_NGT(1).t,cpep_NGT(1).v,<span class="string">'--k'</span>,cpepmod_NGT(1).t,cpepmod_NGT(1).v,<span class="string">'k'</span>,<span class="keyword">...</span>
    cpep_T2Dpre(1).t,cpep_T2Dpre(1).v,<span class="string">'--r'</span>,cpepmod_T2Dpre(1).t,cpepmod_T2Dpre(1).v,<span class="string">'r'</span>)
setAxes(-15, 105, 9, <span class="string">'Time(min)'</span>, 0, 12000, 7, <span class="string">'C-peptide (pmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
title(<span class="string">'Saline'</span>)
subplot(1,3,2)
<span class="comment">%Plot cpeptide - GIP infusion in NGT and T2D pre glucose normalization</span>
plot(cpep_NGT(2).t,cpep_NGT(2).v,<span class="string">'--k'</span>,cpepmod_NGT(2).t,cpepmod_NGT(2).v,<span class="string">'k'</span>,<span class="keyword">...</span>
    cpep_T2Dpre(2).t,cpep_T2Dpre(2).v,<span class="string">'--r'</span>,cpepmod_T2Dpre(2).t,cpepmod_T2Dpre(2).v,<span class="string">'r'</span>)
setAxes(-15, 105, 9, <span class="string">'Time(min)'</span>, 0, 12000, 7, <span class="string">''</span>) <span class="comment">% generate the figure with the proper layout</span>
title(<span class="string">'GIP'</span>)
subplot(1,3,3)
<span class="comment">%Plot cpeptide - GLP1 infusion in NGT and T2D pre glucose normalization</span>
plot(cpep_NGT(3).t,cpep_NGT(3).v,<span class="string">'--k'</span>,cpepmod_NGT(3).t,cpepmod_NGT(3).v,<span class="string">'k'</span>,<span class="keyword">...</span>
    cpep_T2Dpre(3).t,cpep_T2Dpre(3).v,<span class="string">'--r'</span>,cpepmod_T2Dpre(3).t,cpepmod_T2Dpre(3).v,<span class="string">'r'</span>)
setAxes(-15, 105, 9, <span class="string">'Time(min)'</span>, 0, 12000, 7, <span class="string">''</span>) <span class="comment">% generate the figure with the proper layout</span>
title(<span class="string">'GLP1'</span>)
legend(<span class="string">'NGT data'</span>,<span class="string">'NGT model'</span>,<span class="string">'T2D data'</span>,<span class="string">'T2D model'</span>)
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_10.png" style="width:800px;height:400px;" alt=""> <h2>- Study B3: hiperglycemic clamp (HGC) with saline or GIP infusion - NGT subjects<a name="10"></a></h2><p>Data from Vilsboll et al., 2002</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Vilsboll/Vilsboll_NGT_prot2</span>

<span class="comment">% Simulate calcium - saline infusion</span>
pca=[p_peak;p(17:23)];<span class="comment">% calcium parameter</span>
camod=casim(glu,pca);
<span class="comment">% Simulate calcium - GIP infusion low dose (4 pmol/kg/min)</span>
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;


<span class="comment">% Simulate secretion - saline infusion</span>
secmod=secsim_IE(p,camod,glu,Kglu);<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>

<span class="comment">% Simulate secretion with the contribution of the incretin effect</span>
<span class="comment">% GIP infusion low dose (4 pmol/kg/min)</span>
Kincr_glu.t=Kincr.t;
Kincr_glu.v=Kincr.v.*Kglu.v; <span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
secmod_IE=secsim_IE(p,camod_IE,glu,Kincr_glu);

<span class="comment">% Calculate cpeptide</span>
[pcp,~,~]=vancau(<span class="string">'ND'</span>,<span class="string">'M'</span>,age,weight,height);

<span class="comment">% cpeptide - saline infusion</span>
cpepmod=cpepsim(pcp,glu.t,secmod);
<span class="comment">% cpeptide - GIP infusion low dose (4 pmol/kg/min)</span>
cpepmod_IE=cpepsim(pcp,glu.t,secmod_IE);




<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>

figure()
subplot(4,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-10, 140, 4, <span class="string">''</span>, 5, 20, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>,camod_IE.t,camod_IE.v,<span class="string">'b'</span>)
setAxes(-10, 140, 4, <span class="string">''</span>, 50, 550, 6, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),<span class="string">'k'</span>,Kincr.t,Kincr.v,<span class="string">'b'</span>)
setAxes(-10, 140, 4, <span class="string">''</span>, 1, 3, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,<span class="string">'k'</span>,secmod_IE.t,secmod_IE.v/BSA,<span class="string">'b'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-10, 140, 4, <span class="string">'Time'</span>, <span class="keyword">...</span>
    0, 2500, 6, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline model'</span>,<span class="string">'GIP model'</span>);
title(<span class="string">'NGT'</span>)


<span class="comment">%plot cpeptide</span>
figure()
set(gcf,<span class="string">'position'</span>, [250 250 400 400])
pl=plot(cpep(1).t,cpep(1).v,<span class="string">'--k'</span>,cpepmod.t,cpepmod.v,<span class="string">'k'</span>,<span class="keyword">...</span>
    cpep(2).t,cpep(2).v,<span class="string">'--b'</span>,cpepmod_IE.t,cpepmod_IE.v,<span class="string">'b'</span>);
xlabel(<span class="string">'Time (min)'</span>,<span class="string">'FontSize'</span>,16)
ylabel(<span class="string">'C-peptide (pmol/L)'</span>,<span class="string">'FontSize'</span>,16)
xlim([-10 120])
h=legend(<span class="string">'saline data'</span>,<span class="string">'saline model'</span>,<span class="string">'GIP data'</span>,<span class="string">'GIP model'</span>);
set(h,<span class="string">'Location'</span>,<span class="string">'northwest'</span>)
title(<span class="string">'NGT'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_11.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_12.png" style="width:400px;height:400px;" alt=""> <h2>- Study B3: hiperglycemic clamp (HGC) with saline, GIP infusion at different doses or GLP1 infusion - T2D subjects<a name="11"></a></h2><p>Data from Vilsboll et al., 2002</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Vilsboll/Vilsboll_T2D_prot2</span>


<span class="comment">% Simulate calcium - saline infusion</span>
pca=[p_peak;p(17:23)];<span class="comment">% calcium parameter</span>
camod=casim(glu,pca);
<span class="comment">% Simulate calcium - GIP infusion low dose (4 pmol/kg/min), GIP infusion</span>
<span class="comment">% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)</span>
camod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:3
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
<span class="keyword">end</span>


<span class="comment">% Simulate secretion - saline infusion</span>
secmod=secsim_IE(p,camod,glu,Kglu);<span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>

<span class="comment">% Simulate secretion with the contribution of the incretin effect</span>
<span class="comment">% GIP infusion low dose (4 pmol/kg/min), GIP infusion</span>
<span class="comment">% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)</span>
Kincr_glu=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:3
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v;
<span class="keyword">end</span>     <span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
secmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:3
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu,Kincr_glu(k));
<span class="keyword">end</span>

<span class="comment">% Calculate cpeptide</span>
[pcp,~,~]=vancau(<span class="string">'T2D'</span>,<span class="string">'M'</span>,age,weight,height);

<span class="comment">% cpeptide - saline infusion</span>
cpepmod=cpepsim(pcp,glu.t,secmod);
<span class="comment">% cpeptide - GIP infusion low dose (4 pmol/kg/min), GIP infusion</span>
<span class="comment">% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)</span>
cpepmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:3
    cpepmod_IE(k)=cpepsim(pcp,glu.t,secmod_IE(k));
<span class="keyword">end</span>




<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>
figure()
subplot(4,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-10, 190, 11, <span class="string">''</span>, 5, 20, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>,camod_IE(1).t,camod_IE(1).v,<span class="string">'b'</span>,camod_IE(2).t,camod_IE(2).v,<span class="string">'g'</span>,camod_IE(3).t,camod_IE(3).v,<span class="string">'r'</span>)
setAxes(-10, 190, 11, <span class="string">''</span>, 0, 400, 5, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),<span class="string">'k'</span>,Kincr(1).t,Kincr(1).v,<span class="string">'b'</span>,Kincr(2).t,Kincr(2).v,<span class="string">'g'</span>,Kincr(3).t,Kincr(3).v,<span class="string">'r'</span>)
setAxes(-10, 190, 11, <span class="string">''</span>, 1, 8, 8, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,<span class="string">'k'</span>,secmod_IE(1).t,secmod_IE(1).v/BSA,<span class="string">'b'</span>,secmod_IE(2).t,secmod_IE(2).v/BSA,<span class="string">'g'</span>,secmod_IE(3).t,secmod_IE(3).v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-10, 190, 11, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 2500, 6, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'saline model'</span>,<span class="string">'GIP model'</span>,<span class="string">'GIP high model'</span>,<span class="string">'GLP1 model'</span>)
title(<span class="string">'T2D'</span>)


<span class="comment">% plot cpeptide</span>
figure()
set(gcf,<span class="string">'position'</span>, [250 250 400 400])
pl=plot(cpep(1).t,cpep(1).v,<span class="string">'--k'</span>,cpepmod.t,cpepmod.v,<span class="string">'k'</span>,<span class="keyword">...</span>
    cpep(2).t,cpep(2).v,<span class="string">'--b'</span>,cpepmod_IE(1).t,cpepmod_IE(1).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    cpep(3).t,cpep(3).v,<span class="string">'--g'</span>,cpepmod_IE(2).t,cpepmod_IE(2).v,<span class="string">'g'</span>,<span class="keyword">...</span>
    cpep(4).t,cpep(4).v,<span class="string">'--r'</span>,cpepmod_IE(3).t,cpepmod_IE(3).v,<span class="string">'r'</span>);
xlabel(<span class="string">'Time (min)'</span>,<span class="string">'FontSize'</span>,16)
ylabel(<span class="string">'C-peptide (pmol/L)'</span>,<span class="string">'FontSize'</span>,16)
xlim([-10 190])
h=legend(<span class="string">'saline data'</span>,<span class="string">'saline model'</span>,<span class="string">'GIP data'</span>,<span class="string">'GIP model'</span>,<span class="string">'GIP high data'</span>,<span class="string">'GIP high model'</span>,<span class="keyword">...</span>
    <span class="string">'GLP1 data'</span>,<span class="string">'GLP1 model'</span>);
set(h,<span class="string">'Location'</span>,<span class="string">'northwest'</span>)
title(<span class="string">'T2D'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_13.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_14.png" style="width:400px;height:400px;" alt=""> <h2>- Study B4: hyperglicaemic clamp (HGC) with boluses and infusion of GIP at different doses - NGT subjects<a name="12"></a></h2><p>Data from Meier et al., 2004;</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Meier/Meier_NGT</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=casim(glu,pca);

<span class="comment">% Add to calcium the transient increse due to the incretin effect</span>
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;

<span class="comment">% Simulate secretion with the contribution of the incretin effect</span>
Kincr_glu.t=Kincr.t;
Kincr_glu.v=Kincr.v.*Kglu.v;  <span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
secmod_IE=secsim_IE(p,camod_IE,glu,Kincr_glu);

<span class="comment">% Calculate cpeptide from secmod_IE</span>
[pcp,~,~]=vancau(<span class="string">'ND'</span>,<span class="string">'M'</span>,age,weight,height);
cpepmod_IE=cpepsim(pcp,glu.t,secmod_IE);

<span class="comment">% Plot glucose, calcium, Kincr, secretion, cpeptide</span>


subplot(5,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-60, 180, 9, <span class="string">''</span>, 5, 15, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(5,1,2)
plot(camod_IE.t,camod_IE.v,<span class="string">'b'</span>)
setAxes(-60, 180, 9, <span class="string">''</span>, 0, 500, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(5,1,3)
plot(Kincr.t,Kincr.v,<span class="string">'b'</span>)
setAxes(-60, 180, 9, <span class="string">''</span>, 1, 4, 4, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(5,1,4)
plot(sec.t,sec.v/BSA,<span class="string">'k'</span>,secmod_IE.t,secmod_IE.v/BSA,<span class="string">'b'</span>) <span class="comment">%  sec has been calculated through deconvolution from cpeptide data,...</span>
<span class="comment">% secretion needs to be normalized to body surface</span>
setAxes(-60, 180, 9, <span class="string">''</span>, <span class="keyword">...</span>
    0, 1300, 3, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(5,1,5)
plot(cpep.t,cpep.v,<span class="string">'k'</span>,cpepmod_IE.t,cpepmod_IE.v,<span class="string">'b'</span>);
setAxes(-60, 180, 9, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 3500, 3, <span class="string">'C-peptide (pmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'data'</span>,<span class="string">'model'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_15.png" style="width:560px;height:420px;" alt=""> <h2>- Study B4: hyperglicaemic clamp (HGC) with boluses and infusion of GIP at different doses - T2D subjects<a name="13"></a></h2><p>Data from Meier et al., 2004;</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Meier/Meier_T2D</span>


<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=casim(glu,pca);

<span class="comment">% Add to calcium the transient increse due to the incretin effect</span>
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;

<span class="comment">% Simulate secretion with the contribution of the incretin effect</span>
Kincr_glu.t=Kincr.t;
Kincr_glu.v=Kincr.v.*Kglu.v;  <span class="comment">% Kglu is the potentiating ...</span>
<span class="comment">% effect of glucose during HGC, independent from the incretin effect but that affects the ..</span>
<span class="comment">% refilling as the incretin effect</span>
secmod_IE=secsim_IE(p,camod_IE,glu,Kincr_glu);

<span class="comment">% Calculate cpeptide from secmod_IE</span>
[pcp,~,~]=vancau(<span class="string">'ND'</span>,<span class="string">'M'</span>,age,weight,height);
cpepmod_IE=cpepsim(pcp,glu.t,secmod_IE);

<span class="comment">% Plot glucose, calcium, Kincr, secretion, cpeptide</span>


subplot(5,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-60, 180, 9, <span class="string">''</span>, 5, 15, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(5,1,2)
plot(camod_IE.t,camod_IE.v,<span class="string">'k'</span>)
setAxes(-60, 180, 9, <span class="string">''</span>, 0, 500, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(5,1,3)
plot(Kincr.t,Kincr.v,<span class="string">'k'</span>)
setAxes(-60, 180, 9, <span class="string">''</span>, 1, 3, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(5,1,4)
plot(sec.t,sec.v/BSA,<span class="string">'k'</span>,secmod_IE.t,secmod_IE.v/BSA,<span class="string">'b'</span>) <span class="comment">%  sec has been calculated through deconvolution from cpeptide data,...</span>
<span class="comment">% secretion needs to be normalized to body surface</span>
setAxes(-60, 180, 9, <span class="string">''</span>, <span class="keyword">...</span>
    0, 500, 3, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(5,1,5)
plot(cpep.t,cpep.v,<span class="string">'k'</span>,cpepmod_IE.t,cpepmod_IE.v,<span class="string">'b'</span>);
setAxes(-60, 180, 9, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 1500, 3, <span class="string">'C-peptide (pmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'data'</span>,<span class="string">'model'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_16.png" style="width:560px;height:420px;" alt=""> <h2>- Study C1: glucose ramp with saline infusion or GLP1 infusion at different doses - NGT subjects<a name="14"></a></h2><p>Data from Kjems et al., 2003</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Kjems/Kjems_NGT</span>

<span class="comment">% Calculate calcium from glucose - saline infusion</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=casim(glu,pca);  <span class="comment">% calcium with saline infusiomn</span>
<span class="comment">% Calculate calcium from glucose and GLP1 infusion</span>
camod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{}); <span class="comment">% calcium with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)</span>
<span class="keyword">for</span> k=1:3
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
<span class="keyword">end</span>


<span class="comment">% Simulate secretion with saline infusion</span>
secmod=secsim(p,camod,glu);
<span class="comment">% Simulate secretion with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)</span>
secmod_IE=secsim_IE(p,camod_IE(1),glu,Kincr(1),p,camod_IE(2),glu,Kincr(2),p,camod_IE(3),glu,Kincr(3));


<span class="comment">% Calculate glucose sensitivity as reported in Fig. 6 of Kjems et al., 2003</span>
gsmod.t=[0 0.5 1 2]; <span class="comment">% GLP1 infusion doses</span>
lin_reg=lreg(glu.v,secmod.v/BW);
gsmod.v(1)=lin_reg(1);
<span class="keyword">for</span> k=1:3
    lin_reg=lreg(glu.v,secmod_IE(k).v/BW);
    gsmod.v(k+1)=lin_reg(1);
<span class="keyword">end</span>

<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>


subplot(4,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 4, 12, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,camod_IE(1).t,camod_IE(1).v,camod_IE(2).t,camod_IE(2).v,<span class="keyword">...</span>
    camod_IE(3).t,camod_IE(3).v)
setAxes(-5, 180, 7, <span class="string">''</span>, 50, 250, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),Kincr(1).t,Kincr(1).v,Kincr(2).t,Kincr(2).v,<span class="keyword">...</span>
    Kincr(3).t,Kincr(3).v)
setAxes(-5, 180, 7, <span class="string">''</span>, 1, 12, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BW,secmod_IE(1).t,secmod_IE(1).v/BW,secmod_IE(2).t,secmod_IE(2).v/BW,<span class="keyword">...</span>
    secmod_IE(3).t,secmod_IE(3).v/BW) <span class="comment">%  model secretion needs to be normalized to body weight</span>
setAxes(-5, 180, 7, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 40, 3, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% Figure 6 of Kjems et al., 2003 - NGT</span>
figure()
set(gcf,<span class="string">'position'</span>, [250 250 400 400])
pl=plot(gsmod.t,gs,gsmod.t,gsmod.v,<span class="string">'--o'</span>);
xlabel(<span class="string">'GLP1 (pmol kg^{-1} min^{-1})'</span>,<span class="string">'FontSize'</span>,18)
ylabel(<span class="string">'S vs G (pmol kg^{-1} min^{-1} / mmol L^{-1})'</span>,<span class="string">'FontSize'</span>,18)
h=legend(<span class="string">'NGT data'</span>,<span class="string">'NGT model'</span>);
set(pl,<span class="string">'linewidth'</span>,2)
set(h,<span class="string">'Location'</span>,<span class="string">'northwest'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_17.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_18.png" style="width:400px;height:400px;" alt=""> <h2>- Study C1: glucose ramp with saline infusion or GLP1 infusion at different doses - T2D subjects<a name="15"></a></h2><p>Data from Kjems et al., 2003</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">Kjems/Kjems_T2D</span>


<span class="comment">% Calculate calcium from glucose - saline infusion</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=casim(glu,pca);  <span class="comment">% calcium with saline infusiomn</span>
<span class="comment">% Calculate calcium from glucose and GLP1 infusion</span>
camod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{}); <span class="comment">% calcium with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)</span>
<span class="keyword">for</span> k=1:3
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
<span class="keyword">end</span>


<span class="comment">% Simulate secretion with saline infusion</span>
secmod=secsim(p,camod,glu);
<span class="comment">% Simulate secretion with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)</span>
secmod_IE=secsim_IE(p,camod_IE(1),glu,Kincr(1),p,camod_IE(2),glu,Kincr(2),p,camod_IE(3),glu,Kincr(3));

<span class="comment">% Calculate glucose sensitivity as reported in Fig. 6 of Kjems et al., 2003</span>
gsmod.t=[0 0.5 1 2]; <span class="comment">% GLP1 infusion doses</span>
lin_reg=lreg(glu.v,secmod.v/BW);
gsmod.v(1)=lin_reg(1);
<span class="keyword">for</span> k=1:3
    lin_reg=lreg(glu.v,secmod_IE(k).v/BW);
    gsmod.v(k+1)=lin_reg(1);
<span class="keyword">end</span>

<span class="comment">% Plot glucose, calcium, Kincr, secretion</span>


subplot(4,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 5, 15, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,2)
plot(camod.t,camod.v,camod_IE(1).t,camod_IE(1).v,camod_IE(2).t,camod_IE(2).v,<span class="keyword">...</span>
    camod_IE(3).t,camod_IE(3).v)
setAxes(-5, 180, 7, <span class="string">''</span>, 50, 250, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),Kincr(1).t,Kincr(1).v,Kincr(2).t,Kincr(2).v,<span class="keyword">...</span>
    Kincr(3).t,Kincr(3).v)
setAxes(-5, 180, 7, <span class="string">''</span>, 1, 8, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BW,secmod_IE(1).t,secmod_IE(1).v/BW,secmod_IE(2).t,secmod_IE(2).v/BW,<span class="keyword">...</span>
    secmod_IE(3).t,secmod_IE(3).v/BW) <span class="comment">%  model secretion needs to be normalized to body weight</span>
setAxes(-5, 180, 7, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 40, 3, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>

<span class="comment">% Figure 6 of Kjems et al., 2003 - T2D</span>
figure()
set(gcf,<span class="string">'position'</span>, [250 250 400 400])
pl=plot(gsmod.t,gs,gsmod.t,gsmod.v,<span class="string">'--o'</span>);
xlabel(<span class="string">'GLP1 (pmol kg^{-1} min^{-1})'</span>,<span class="string">'FontSize'</span>,18)
ylabel(<span class="string">'S vs G (pmol kg^{-1} min^{-1} / mmol L^{-1})'</span>,<span class="string">'FontSize'</span>,18)
h=legend(<span class="string">'T2D data'</span>,<span class="string">'T2D model'</span>);
set(pl,<span class="string">'linewidth'</span>,2)
set(h,<span class="string">'Location'</span>,<span class="string">'northwest'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_19.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_20.png" style="width:400px;height:400px;" alt=""> <h2>- Study D1: OGTT and Intravenous glucose infusion simulating an OGTT with saline, GIP or GLP1 infusion - NGT subjects<a name="16"></a></h2><p>Data from Nauck et al., JCEM 1993</p><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

<span class="comment">% load data</span>
load <span class="string">NauckJCEM/NauckJCEM</span>


<span class="comment">% Simulate calcium - OGTT IV</span>
pca=[p_peak;p(17:23)];<span class="comment">% calcium parameter</span>
camod=casim(glu(1),pca);
<span class="comment">% Simulate calcium - OGTT,OGTT IV + GIP infusion, GLP1 infusion, GIP and GLP1 infusion</span>
camod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
catmp=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:4
    catmp(k)=casim(glu(k+1),pca);
    camod_IE(k).t=catmp(k).t;
    camod_IE(k).v=catmp(k).v+ca_transient(k).v;
<span class="keyword">end</span>

<span class="comment">% Simulate secretion - OGTT IV</span>
secmod=secsim(p,camod,glu(1));

<span class="comment">% Simulate secretion - OGTT, OGTT IV + GIP infusion, GLP1 infusion, GIP and GLP1 infusion</span>
secmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:4
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu(k+1),Kincr(k));
<span class="keyword">end</span>


<span class="comment">% Calculate cpeptide</span>
[pcp,~,~]=vancau(<span class="string">'ND'</span>,<span class="string">'M'</span>,age,weight,height);

<span class="comment">% cpeptide - OGTT IV</span>
cpepmod=cpepsim(pcp,glu(1).t,secmod);
<span class="comment">% cpeptide - OGTT and OGTT IV + GIP infusion, GLP1 infusion, GIPA and GLP1 infusion</span>
cpepmod_IE=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:4
    cpepmod_IE(k)=cpepsim(pcp,glu(k+1).t,secmod_IE(k));
<span class="keyword">end</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block
'betavars/tau_k' is automatically set to support direct feedthrough. This may
cause an algebraic loop. A Memory Block can be used in place of the Transport
Delay to break the loop 
</pre><p>Plot glucose, calcium, Kincr, secretion - OGTT-like</p><pre class="codeinput">subplot(4,1,1)
plot(glu(1).t,glu(1).v,<span class="string">'k'</span>)
setAxes(-30, 220, 6, <span class="string">''</span>, 5, 15, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
title(<span class="string">'OGTT like'</span>)
subplot(4,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-30, 220, 6, <span class="string">''</span>, 50, 250, 5, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(glu(1).t,ones(1,numel(glu(1).t)),<span class="string">'k'</span>)
setAxes(-30, 220, 6, <span class="string">''</span>, 0.5, 1.5, 3, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,<span class="string">'k'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-30, 220, 6, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 500, 3, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>

titles={<span class="string">'OGTT'</span> <span class="string">'GIP infusion'</span> <span class="string">'GLP-1 infusion'</span> <span class="string">'GIP and GLP-1 infusion'</span>};
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_21.png" style="width:560px;height:420px;" alt=""> <pre class="codeinput">figure()
<span class="keyword">for</span> k=1:4
subplot(4,1,1)
plot(glu(k+1).t,glu(k+1).v,<span class="string">'k'</span>)
setAxes(-30, 220, 6, <span class="string">''</span>, 5, 15, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
title(sprintf(titles{k}))
subplot(4,1,2)
plot(camod_IE(k).t,camod_IE(k).v,<span class="string">'k'</span>)
setAxes(-30, 220, 6, <span class="string">''</span>, 50, 250, 5, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,3)
plot(Kincr(k).t,Kincr(k).v,<span class="string">'k'</span>)
setAxes(-30, 220, 6, <span class="string">''</span>, 1, 5, 5, <span class="string">'Kincr'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(4,1,4)
plot(secmod_IE(k).t,secmod_IE(k).v/BSA,<span class="string">'k'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-30, 220, 6, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 800, 5, <span class="string">'S (pmol Kg min^{-1})'</span>) <span class="comment">% generate the figure with the proper layout</span>
<span class="keyword">end</span>

<span class="comment">% Plot cpeptide</span>
figure()
plot(cpep(1).t,cpep(1).v,<span class="string">'--k'</span>,cpepmod.t,cpepmod.v,<span class="string">'k'</span>,<span class="keyword">...</span>
    cpep(2).t,cpep(2).v,<span class="string">'--g'</span>,cpepmod_IE(1).t,cpepmod_IE(1).v,<span class="string">'-g'</span>);
setAxes(-30, 220, 6, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 4000, 5, <span class="string">'C-peptide (pmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'OGTT IV data'</span>,<span class="string">'OGTT IV model'</span>,<span class="string">'OGTT data'</span>,<span class="string">'OGTT model'</span>)


figure()
plot(cpep(3).t,cpep(3).v,<span class="string">'--b'</span>,cpepmod_IE(2).t,cpepmod_IE(2).v,<span class="string">'b'</span>,<span class="keyword">...</span>
    cpep(4).t,cpep(4).v,<span class="string">'--r'</span>,cpepmod_IE(3).t,cpepmod_IE(3).v,<span class="string">'-r'</span>,<span class="keyword">...</span>
     cpep(5).t,cpep(5).v,<span class="string">'--m'</span>,cpepmod_IE(4).t,cpepmod_IE(4).v,<span class="string">'-m'</span>);
setAxes(-30, 220, 6, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 4000, 5, <span class="string">'C-peptide (pmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
legend(<span class="string">'GIP data'</span>,<span class="string">'GIP model'</span>,<span class="string">'GLP1 data'</span>,<span class="string">'GLP1 model'</span>,<span class="string">'GIP and GLP1 data'</span>,<span class="string">'GIP and GLP1 model'</span>)
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_22.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_23.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_24.png" style="width:560px;height:420px;" alt=""> <h2>Data analysis<a name="19"></a></h2><p>For each test we created a vector containing 6 elements: - element 1 of the vector: GIP or GLP1 infusion rate (pmol/kg/min) - element 2 of the vector GIP or GLP1 basal concentration (pmol/L) - total GIP or GLP1 - element 3 of the vector: AUC Kincr - element 4 of the vector: AUC calcium transient due to the incretin effect (nmol/L) - element 5 of the vector: AUC glu during the incretins stimulus (mmol/L) - element 6 of the vecotr: AUC of GIP or GLP1 concentration (pmol/L) - total GIP or GLP1 The vectors are saved in the file analysis_all_tests</p><pre class="codeinput"><span class="comment">% Element 2 and element 6 of the vectors referring to Nauck JCI and Nauck</span>
<span class="comment">% JCEM studies are already rescaled as described in the methods part of the</span>
<span class="comment">% article of Grespan et al. 2019</span>

clear <span class="string">all</span>
close <span class="string">all</span>
clc
load <span class="string">analysis_all_tests</span>



<span class="comment">% plot GIP and GLP1 concentration vs Kincr calculated by the model for all</span>
<span class="comment">% the diffferent tests</span>
load <span class="string">Kincrmod</span>

figure()
subplot(1,2,1)
p1=plot(test_GIP_NGT_Meier(:,6),test_GIP_NGT_Meier(:,3),<span class="string">'ob'</span>,<span class="keyword">...</span>
    test_GIP_NGT_Honka(:,6),test_GIP_NGT_Honka(:,3),<span class="string">'sb'</span>,<span class="keyword">...</span>
    test_GIP_NGT_Hojberg(:,6),test_GIP_NGT_Hojberg(:,3),<span class="string">'^b'</span>,<span class="keyword">...</span>
    test_GIP_NGT_Vilsboll(:,6),test_GIP_NGT_Vilsboll(:,3),<span class="string">'*b'</span>,<span class="keyword">...</span>
    test_GIP_NGT_NauckJCI(:,6),test_GIP_NGT_NauckJCI(:,3),<span class="string">'xb'</span>,<span class="keyword">...</span>
    test_GIP_NGT_NauckJCEM(:,6),test_GIP_NGT_NauckJCEM(:,3),<span class="string">'+b'</span>,<span class="keyword">...</span>
    test_GIP_GIPANDGLP1_NGT_NauckJCEM(:,6),test_GIP_GIPANDGLP1_NGT_NauckJCEM(:,3),<span class="string">'+b'</span>,<span class="keyword">...</span>
    Kincrmod_GIP_NGT(1).t,Kincrmod_GIP_NGT(1).v,<span class="string">'-b'</span>,<span class="keyword">...</span>
    test_GLP1_NGT_Honka(:,6),test_GLP1_NGT_Honka(:,3),<span class="string">'sr'</span>,<span class="keyword">...</span>
    test_GLP1_NGT_Kjems(:,6),test_GLP1_NGT_Kjems(:,3),<span class="string">'dr'</span>,<span class="keyword">...</span>
    test_GLP1_NGT_Hojberg(:,6),test_GLP1_NGT_Hojberg(:,3),<span class="string">'^r'</span>,<span class="keyword">...</span>
    test_GLP1_NGT_NauckJCI(:,6),test_GLP1_NGT_NauckJCI(:,3),<span class="string">'xr'</span>,<span class="keyword">...</span>
    test_GLP1_NGT_NauckJCEM(:,6),test_GLP1_NGT_NauckJCEM(:,3),<span class="string">'+r'</span>,<span class="keyword">...</span>
    test_GLP1_GIPANDGLP1_NGT_NauckJCEM(:,6),test_GLP1_GIPANDGLP1_NGT_NauckJCEM(:,3),<span class="string">'+r'</span>,<span class="keyword">...</span>
    Kincrmod_GLP1_NGT(1).t,Kincrmod_GLP1_NGT(1).v,<span class="string">'-r'</span>);
xlim([0 500])
ylim([1 10])
xlabel(<span class="string">'Total hormone concentration (pmol/L)'</span>)
ylabel(<span class="string">'Incretin potentiation of ISR (k_{incr})'</span>)
set(p1,<span class="string">'linewidth'</span>,2)
set(gca,<span class="string">'FontSize'</span>,14)
title(<span class="string">'NGT'</span>)

subplot(1,2,2)
p1=plot(test_GIP_T2D_Mentis(:,6),test_GIP_T2D_Mentis(:,3),<span class="string">'vb'</span>,<span class="keyword">...</span>
    test_GIP_T2D_Meier(:,6),test_GIP_T2D_Meier(:,3),<span class="string">'ob'</span>,<span class="keyword">...</span>
    test_GIP_T2Dpre_Hojberg(:,6),test_GIP_T2Dpre_Hojberg(:,3),<span class="string">'^b'</span>,<span class="keyword">...</span>
    test_GIP_T2D_Vilsboll(:,6),test_GIP_T2D_Vilsboll(:,3),<span class="string">'*b'</span>,<span class="keyword">...</span>
    test_GIP_T2D_NauckJCI(:,6),test_GIP_T2D_NauckJCI(:,3),<span class="string">'xb'</span>,<span class="keyword">...</span>
    Kincrmod_GIP_T2D.t,Kincrmod_GIP_T2D.v,<span class="string">'-b'</span>,<span class="keyword">...</span>
    test_GLP1_T2D_Mentis(:,6),test_GLP1_T2D_Mentis(:,3),<span class="string">'vr'</span>,<span class="keyword">...</span>
    test_GLP1_T2D_Kjems(:,6),test_GLP1_T2D_Kjems(:,3),<span class="string">'dr'</span>,<span class="keyword">...</span>
    test_GLP1_T2Dpre_Hojberg(:,6),test_GLP1_T2Dpre_Hojberg(:,3),<span class="string">'^r'</span>,<span class="keyword">...</span>
    test_GLP1_T2D_Vilsboll(:,6),test_GLP1_T2D_Vilsboll(:,3),<span class="string">'*r'</span>,<span class="keyword">...</span>
    test_GLP1_T2D_NauckJCI(:,6),test_GLP1_T2D_NauckJCI(:,3),<span class="string">'xr'</span>,<span class="keyword">...</span>
    Kincrmod_GLP1_T2D.t,Kincrmod_GLP1_T2D.v,<span class="string">'-r'</span>);
xlim([0 500])
ylim([1 10])
<span class="comment">%set(gca,'xTick',[0 1 2 3 4 8 12 16])</span>
xlabel(<span class="string">'Total hormone concentration (pmol/L)'</span>)
ylabel(<span class="string">'Incretin potentiation of ISR (k_{incr})'</span>)
set(p1,<span class="string">'linewidth'</span>,2)
set(gca,<span class="string">'FontSize'</span>,14)
title(<span class="string">'T2D'</span>)



<span class="comment">% plot hormone-Kincr relationship used to simulate Study D1</span>
figure()
p1=plot(Kincrmod_GIP_NGT(2).t,Kincrmod_GIP_NGT(2).v,<span class="string">'-b'</span>,<span class="keyword">...</span>
    Kincrmod_GLP1_NGT(2).t,Kincrmod_GLP1_NGT(2).v,<span class="string">'-r'</span>);
xlim([0 400])
ylim([1 10])
xlabel(<span class="string">'Total hormone concentration (pmol/L)'</span>)
ylabel(<span class="string">'Incretin potentiation of ISR (k_{incr})'</span>)
set(p1,<span class="string">'linewidth'</span>,2)
set(gca,<span class="string">'FontSize'</span>,14)
title(<span class="string">'NGT'</span>)
</pre><img vspace="5" hspace="5" src="IncretinModel_sim_25.png" style="width:560px;height:420px;" alt=""> <img vspace="5" hspace="5" src="IncretinModel_sim_26.png" style="width:560px;height:420px;" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2015b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Code for the beta-cell insulin secretion model incorporating the incretin effect
% 
%
% 
%


%% 
addpath(genpath('model_functions'))

%% Parameters initialization
%
% The parameters are the result of the fit to the
% experimental data (see below for the list of 
% publications). 
% 
% Each dataset (related to a specific experimental condition) and the corresponding 
% reference parameter vector are saved in a different file .mat.
%
%
% Each element of the p vector correspond to a parameter in the equations
% of the article:
% p(1)REPLACE_WITH_DASH_DASH> p6 in the equation of the article
% p(2)REPLACE_WITH_DASH_DASH> p7 in the equation of the article
% p(3)REPLACE_WITH_DASH_DASH> p8 in the equation of the article
% p(4)REPLACE_WITH_DASH_DASH> p9 in the equation of the article
% p(5)REPLACE_WITH_DASH_DASH> p10 in the equation of the article
% p(6)REPLACE_WITH_DASH_DASH> p11 in the equation of the article
% p(7)REPLACE_WITH_DASH_DASH> Parameter not used
% p(8)REPLACE_WITH_DASH_DASH> p5 in the equation of the article
% p(9)REPLACE_WITH_DASH_DASH> p1 in the equation of the article
% p(10)REPLACE_WITH_DASH_DASH> p2 in the equation of the article
% p(11)REPLACE_WITH_DASH_DASH> p3 in the equation of the article
% p(12)REPLACE_WITH_DASH_DASH> p4 in the equation of the article
% p(13)REPLACE_WITH_DASH_DASH> p15 in the equation of the article
% p(14)REPLACE_WITH_DASH_DASH> p14 in the equation of the article
% p(15)REPLACE_WITH_DASH_DASH> p12 in the equation of the article
% p(16)REPLACE_WITH_DASH_DASH> p13 in the equation of the article
% p(17)REPLACE_WITH_DASH_DASH> p21 in the equation of the article
% p(18)REPLACE_WITH_DASH_DASH> p22 in the equation of the article
% p(19)REPLACE_WITH_DASH_DASH> p23 in the equation of the article
% p(20)REPLACE_WITH_DASH_DASH> p24 in the equation of the article
% p(21)REPLACE_WITH_DASH_DASH> p16 in the equation of the article
% p(22)REPLACE_WITH_DASH_DASH> p17 in the equation of the article
% p(23)REPLACE_WITH_DASH_DASH> p18 in the equation of the article

% The vector p_peak is held fixed
% p_peak(1)REPLACE_WITH_DASH_DASH> p19 in the equation of the article
% p_peak(2)REPLACE_WITH_DASH_DASH> p20 in the equation of the article


%% - Study A1: GIP or GLP1 infusion at basal glucose - NGT subjects 
%
% Data from Honka et al., 2018
clear all
close all
clc

% load data
load Honka/Honka

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter
camod=struct('t',{},'v',{});
for k=1:2
    camod(k)=casim(glu(k),pca);
end

% Add to calcium the transient increse due to the GIP or GLP-1 
% GIP infusion (2 pmol/kg/min), GLP-1 infusion (0.75 pmol/kg/min)
camod_IE=struct('t',{},'v',{});
for k=1:2
    camod_IE(k).t=camod(k).t;
    camod_IE(k).v=camod(k).v+ca_transient(k).v;  % calcium with incretins
end

% Simulate secretion with the contribution of the incretin effect 
secmod_IE=struct('t',{},'v',{});
for k=1:2
secmod_IE(k)=secsim_IE(p,camod_IE(k),glu(k),Kincr(k));
end

% Plot glucose, calcium, Kincr, secretion


subplot(4,1,1)
plot(glu(1).t,glu(1).v,'REPLACE_WITH_DASH_DASHb',glu(2).t,glu(2).v,'REPLACE_WITH_DASH_DASHr')
setAxes(-10, 80, 10, '', 3, 6, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod_IE(1).t,camod_IE(1).v,'b',camod_IE(2).t,camod_IE(2).v,'r')
setAxes(-10, 80, 10, '', 50, 150, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(Kincr(1).t,Kincr(1).v,'b',Kincr(2).t,Kincr(2).v,'r') 
setAxes(-10, 80, 10, '', 1, 5, 5, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(sec(1).t,sec(1).v,'REPLACE_WITH_DASH_DASHb',secmod_IE(1).t,secmod_IE(1).v/BSA,'b',...
    sec(2).t,sec(2).v,'REPLACE_WITH_DASH_DASHr',secmod_IE(2).t,secmod_IE(2).v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-10, 80, 10, 'Time (min)', ...
    0, 300, 3, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout
legend('GIP data','GIP model','GLP-1 data','GLP-1 model')



%% - Study A2: saline, GIP or GLP1 infusion at basal glucose - T2D subjects
%
% Data from Mentis et al., 2010
clear all
close all
clc

% load data
load Mentis/Mentis

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter
camod=casim(glu(1),pca); % calcium without incretins
% Simulate calcium - GIP infusion low dose (4 pmol/kg/min), GIP infusion
% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)
camod_IE=struct('t',{},'v',{});
catmp=struct('t',{},'v',{});
for k=1:2
    catmp(k)=casim(glu(k+1),pca);
    camod_IE(k).t=catmp(k).t;
    camod_IE(k).v=catmp(k).v+ca_transient.v; % calcium with incretins
end



% Simulate secretion - saline infusion
secmod=secsim_IE(p,camod,glu(1),Kglu);% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect

% Simulate secretion with the contribution of the incretin effect
% GIP infusion low dose (4 pmol/kg/min), GIP infusion
% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)
Kincr_glu=struct('t',{},'v',{});
for k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v; 
end     % Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
secmod_IE=struct('t',{},'v',{});
for k=1:2
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu(k+1),Kincr_glu(k));
end

% Calculate cpeptide 
[pcp,~,~]=vancau('T2D','M',age,weight,height); 

% cpeptide - saline infusion
cpepmod=cpepsim(pcp,glu(1).t,secmod);
% cpeptide - GIP infusion low dose (4 pmol/kg/min), GIP infusion
% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)
cpepmod_IE=struct('t',{},'v',{});
for k=1:2
    cpepmod_IE(k)=cpepsim(pcp,glu(k).t,secmod_IE(k)); 
end


% Plot glucose, calcium, Kincr, secretion


subplot(4,1,1)
plot(glu(1).t,glu(1).v,'REPLACE_WITH_DASH_DASHk',glu(2).t,glu(2).v,'REPLACE_WITH_DASH_DASHb',glu(3).t,glu(3).v,'REPLACE_WITH_DASH_DASHr')
setAxes(0, 240, 50, '', 5, 20, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,'k',camod_IE(1).t,camod_IE(1).v,'b',camod_IE(2).t,camod_IE(2).v,'r')
setAxes(0, 240, 10, '', 50, 450, 5, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu(1).t,ones(1,numel(glu(1).t)),'k',Kincr(1).t,Kincr(1).v,'b',...
    Kincr(2).t,Kincr(2).v,'r') 
setAxes(0, 240,10, '', 1, 8, 8, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,'k',secmod_IE(1).t,secmod_IE(1).v/BSA,'b',...
    secmod_IE(2).t,secmod_IE(2).v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(0, 360, 7, 'Time (min)', ...
    0, 600, 5, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout
legend('saline model','GIP model','GLP1 model')



figure()
plot(cpep(1).t,cpep(1).v,'REPLACE_WITH_DASH_DASHk',cpepmod.t,cpepmod.v,'k',...
    cpep(2).t,cpep(2).v,'REPLACE_WITH_DASH_DASHb',cpepmod_IE(1).t,cpepmod_IE(1).v,'b',...
    cpep(3).t,cpep(3).v,'REPLACE_WITH_DASH_DASHr',cpepmod_IE(2).t,cpepmod_IE(2).v,'r');
setAxes(0, 360, 7, 'Time (min)', ...
    800, 1800, 6, 'C-peptide (pmol/L)') % generate the figure with the proper layout
legend('saline data','saline model','GIP data','GIP model','GLP1 data','GLP1 model')






%% - Study B1: hiperglycemic clamp (HGC) with saline, GIP infusion or GLP1 infusion at different doses - NGT subjects
%
% Data from Nauck et al., JCI 1993
clear all
close all
clc

% load data
load NauckJCI/NauckJCI_NGT


% Simulate calcium - saline infusion
pca=[p_peak;p(17:23)];% calcium parameter
camod=casim(glu,pca);
% Simulate calcium - GIP and GLP1 infusion 
camod_IE=struct('t',{},'v',{});
for k=1:2
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
end

% Simulate secretion - saline infusion
secmod=secsim_IE(p,camod,glu,Kglu);% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect

% Simulate secretion with the contribution of GIP or GLP1 infusion
Kincr_glu=struct('t',{},'v',{});
for k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v; 
end     % Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
secmod_IE=struct('t',{},'v',{});
for k=1:2
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu,Kincr_glu(k));
end

% Calculate cpeptide 
[pcp,~,~]=vancau('ND','M',age,weight,height); 

% cpeptide - saline infusion
cpepmod=cpepsim(pcp,cpep(1).t,secmod);
% cpeptide - GIP infusion low dose (4 pmol/kg/min), GIP infusion
% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)
cpepmod_IE=struct('t',{},'v',{});
for k=1:2
    cpepmod_IE(k)=cpepsim(pcp,cpep(k+1).t,secmod_IE(k)); 
end

% Plot glucose, calcium, Kincr, secretion


subplot(4,1,1)
plot(glu.t,glu.v,'k')
setAxes(-20, 120, 8, '', 5, 10, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,'k',camod_IE(1).t,camod_IE(1).v,'b',...
    camod_IE(2).t,camod_IE(2).v,'r')
setAxes(-20, 120, 8, '', 50, 350, 4, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),'k',Kincr(1).t,Kincr(1).v,'b',...
    Kincr(2).t,Kincr(2).v,'r') 
setAxes(-20, 120,8, '', 1, 10, 3, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,'k',secmod_IE(1).t,secmod_IE(1).v/BSA,'b',...
    secmod_IE(2).t,secmod_IE(2).v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-30, 120, 6, 'Time (min)', ...
    0, 1500, 4, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout
legend('saline model','GIP model','GLP1 model')


% Plot cpeptide
figure()
plot(cpep(1).t,cpep(1).v*1000,'REPLACE_WITH_DASH_DASHk',cpepmod.t,cpepmod.v,'k',...     % *1000 to express in pmol/L
    cpep(2).t,cpep(2).v*1000,'REPLACE_WITH_DASH_DASHb',cpepmod_IE(1).t,cpepmod_IE(1).v,'b',...
    cpep(3).t,cpep(3).v*1000,'REPLACE_WITH_DASH_DASHr',cpepmod_IE(2).t,cpepmod_IE(2).v,'r');
setAxes(-30, 120, 6, 'Time (min)', ...
    0, 8000, 5, 'C-peptide (pmol/L)') % generate the figure with the proper layout
legend('saline data','saline model','GIP data','GIP model','GLP1 data','GLP1 model')



%% - Study B1: hiperglycemic clamp (HGC) with saline, GIP infusion or GLP1 infusion at different doses - T2D subjects
%
% Data from Nauck et al., JCI 1993
clear all
close all
clc

% load data
load NauckJCI/NauckJCI_T2D


% Simulate calcium - saline infusion
pca=[p_peak;p(17:23)];% calcium parameter
camod=casim(glu,pca);
% Simulate calcium - GIP and GLP1 infusion 
camod_IE=struct('t',{},'v',{});
for k=1:2
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
end

% Simulate secretion - saline infusion
secmod=secsim_IE(p,camod,glu,Kglu);% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect

% Simulate secretion with the contribution of GIP or GLP1 infusion
Kincr_glu=struct('t',{},'v',{});
for k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v; 
end     % Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
secmod_IE=struct('t',{},'v',{});
for k=1:2
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu,Kincr_glu(k));
end

% Calculate cpeptide 
[pcp,~,~]=vancau('T2D','M',age,weight,height); 

% cpeptide - saline infusion
cpepmod=cpepsim(pcp,cpep(1).t,secmod);
% cpeptide - GIP infusion low dose (4 pmol/kg/min), GIP infusion
% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)
cpepmod_IE=struct('t',{},'v',{});
for k=1:2
    cpepmod_IE(k)=cpepsim(pcp,cpep(k+1).t,secmod_IE(k)); 
end

% Plot glucose, calcium, Kincr, secretion


subplot(4,1,1)
plot(glu.t,glu.v,'k')
setAxes(-20, 120, 8, '', 5, 10, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,'k',camod_IE(1).t,camod_IE(1).v,'b',...
    camod_IE(2).t,camod_IE(2).v,'r')
setAxes(-20, 120, 8, '', 50, 350, 4, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),'k',Kincr(1).t,Kincr(1).v,'b',...
    Kincr(2).t,Kincr(2).v,'r') 
setAxes(-20, 120,8, '', 1, 10, 3, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,'k',secmod_IE(1).t,secmod_IE(1).v/BSA,'b',...
    secmod_IE(2).t,secmod_IE(2).v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-30, 120, 6, 'Time (min)', ...
    0, 1500, 4, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout
legend('saline model','GIP model','GLP1 model')

% Plot cpeptide
figure()
plot(cpep(1).t,cpep(1).v*1000,'REPLACE_WITH_DASH_DASHk',cpepmod.t,cpepmod.v,'k',...   % *1000 to express in pmol/L
    cpep(2).t,cpep(2).v*1000,'REPLACE_WITH_DASH_DASHb',cpepmod_IE(1).t,cpepmod_IE(1).v,'b',...
    cpep(3).t,cpep(3).v*1000,'REPLACE_WITH_DASH_DASHr',cpepmod_IE(2).t,cpepmod_IE(2).v,'r');
setAxes(-30, 120, 6, 'Time (min)', ...
    0, 8000, 5, 'C-peptide (pmol/L)') % generate the figure with the proper layout
legend('saline data','saline model','GIP data','GIP model','GLP1 data','GLP1 model')







%% - Study B2: hyperglicaemic clamp (HGC) with saline, GIP or GLP1 infusion - NGT subjects
%
% Data from Hojberg et al., 2009
clear all
close all
clc

% load data
load Hojberg/Hojberg_NGT


% Calculate calcium from glucose - saline infusion
pca=[p_peak;p(17:23)]; % calcium parameter
camod=casim(glu,pca);  % calcium with saline infusiomn
% Calculate calcium from glucose and GIP or GLP1 infusion
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;

% Simulate secretion with saline infusion
secmod=secsim_IE(p,camod,glu,Kglu);% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect

% Simulate secretion with the contribution of the incretin effect 
Kincr_glu=struct('t',{},'v',{});% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
for k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v;
end
secmod_IE=secsim_IE(p,camod_IE,glu,Kincr_glu(1),p,camod_IE,glu,Kincr_glu(2));

% Calculate cpeptide from secmod_IE
[pcp,~,~]=vancau('ND','M',age,weight,height); 

cpepmod=cpepsim(pcp,glu.t,secmod); 
cpepmod_IE=struct('t',{},'v',{}); 
for k=1:2
    cpepmod_IE(k)=cpepsim(pcp,glu.t,secmod_IE(k)); 
end


% Plot glucose, calcium, Kincr, secretion


subplot(4,1,1)
plot(glu.t,glu.v,'k')
setAxes(-15, 110, 9, '', 5, 20, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,'k',camod_IE.t,camod_IE.v,'b')
setAxes(-15, 110, 9, '', 50, 400, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),'k',Kincr(1).t,Kincr(1).v,'b',Kincr(2).t,Kincr(2).v,'b') 
setAxes(-15, 110, 9, '', 1, 2, 3, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,'k',secmod_IE(1).t,secmod_IE(1).v/BSA,'r',secmod_IE(2).t,secmod_IE(2).v/BSA,'b') %  model secretion needs to be normalized to body surface
setAxes(-15, 105, 9, 'Time (min)', ...
    0, 1800, 7, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout
legend('saline','GIP','GLP-1')
title('NGT')


cpep_NGT(1)=cpep(1);
cpep_NGT(2)=cpep(2);
cpep_NGT(3)=cpep(3);
cpepmod_NGT(1)=cpepmod;
cpepmod_NGT(2)=cpepmod_IE(1);
cpepmod_NGT(3)=cpepmod_IE(2);

%% - Study B2: hyperglicaemic clamp (HGC) with saline, GIP or GLP1 infusion - T2D subjects (pre glucose normalization)
%
% Data from Hojberg et al., 2009
%clear all
close all
clc

% load data
load Hojberg/Hojberg_T2D_pre


% Calculate calcium from glucose - saline infusion
pca=[p_peak;p(17:23,1)]; % calcium parameter
camod=casim(glu,pca);  % calcium with saline infusiomn
% Calculate calcium from glucose and GIP or GLP1 infusion
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;

% Simulate secretion with saline infusion
secmod=secsim_IE(p(:,1),camod,glu,Kglu);% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect

% Simulate secretion with the contribution of the incretin effect 
Kincr_glu=struct('t',{},'v',{});% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
for k=1:2
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v;
end
secmod_IE=secsim_IE(p(:,2),camod_IE,glu,Kincr_glu(1),p(:,3),camod_IE,glu,Kincr_glu(2));

% Calculate cpeptide from secmod_IE
[pcp,~,~]=vancau('T2D','M',age,weight,height); 

cpepmod=cpepsim(pcp,glu.t,secmod); 
cpepmod_IE=struct('t',{},'v',{}); % calcium with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)
for k=1:2
    cpepmod_IE(k)=cpepsim(pcp,glu.t,secmod_IE(k)); 
end


% Plot glucose, calcium, Kincr, secretion


subplot(4,1,1)
plot(glu.t,glu.v,'k')
setAxes(-15, 110, 9, '', 10, 20, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,'k',camod_IE.t,camod_IE.v,'r')
setAxes(-15, 110, 9, '', 50, 350, 4, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),'k',Kincr(1).t,Kincr(1).v,'b',Kincr(2).t,Kincr(2).v,'r') 
setAxes(-15, 110, 9, '', 1, 2, 3, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,'k',secmod_IE(1).t,secmod_IE(1).v/BSA,'b',secmod_IE(2).t,secmod_IE(2).v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-15, 105, 9, 'Time (min)', ...
    0, 300, 3, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout
legend('saline','GIP','GLP-1')
title('T2D')


cpep_T2Dpre(1)=cpep(1);
cpep_T2Dpre(2)=cpep(2);
cpep_T2Dpre(3)=cpep(3);
cpepmod_T2Dpre(1)=cpepmod;
cpepmod_T2Dpre(2)=cpepmod_IE(1);
cpepmod_T2Dpre(3)=cpepmod_IE(2);



%% - Study B2: plot cpeptide 


figure()
set(gcf,'position', [250 250 800 400]) 
subplot(1,3,1)
%Plot cpeptide - saline infusion in NGT and T2D pre glucose normalization 
plot(cpep_NGT(1).t,cpep_NGT(1).v,'REPLACE_WITH_DASH_DASHk',cpepmod_NGT(1).t,cpepmod_NGT(1).v,'k',...
    cpep_T2Dpre(1).t,cpep_T2Dpre(1).v,'REPLACE_WITH_DASH_DASHr',cpepmod_T2Dpre(1).t,cpepmod_T2Dpre(1).v,'r')
setAxes(-15, 105, 9, 'Time(min)', 0, 12000, 7, 'C-peptide (pmol/L)') % generate the figure with the proper layout
title('Saline')
subplot(1,3,2)
%Plot cpeptide - GIP infusion in NGT and T2D pre glucose normalization 
plot(cpep_NGT(2).t,cpep_NGT(2).v,'REPLACE_WITH_DASH_DASHk',cpepmod_NGT(2).t,cpepmod_NGT(2).v,'k',...
    cpep_T2Dpre(2).t,cpep_T2Dpre(2).v,'REPLACE_WITH_DASH_DASHr',cpepmod_T2Dpre(2).t,cpepmod_T2Dpre(2).v,'r')
setAxes(-15, 105, 9, 'Time(min)', 0, 12000, 7, '') % generate the figure with the proper layout
title('GIP')
subplot(1,3,3)
%Plot cpeptide - GLP1 infusion in NGT and T2D pre glucose normalization 
plot(cpep_NGT(3).t,cpep_NGT(3).v,'REPLACE_WITH_DASH_DASHk',cpepmod_NGT(3).t,cpepmod_NGT(3).v,'k',...
    cpep_T2Dpre(3).t,cpep_T2Dpre(3).v,'REPLACE_WITH_DASH_DASHr',cpepmod_T2Dpre(3).t,cpepmod_T2Dpre(3).v,'r')
setAxes(-15, 105, 9, 'Time(min)', 0, 12000, 7, '') % generate the figure with the proper layout
title('GLP1')
legend('NGT data','NGT model','T2D data','T2D model')



%% - Study B3: hiperglycemic clamp (HGC) with saline or GIP infusion - NGT subjects
%
% Data from Vilsboll et al., 2002
clear all
close all
clc

% load data
load Vilsboll/Vilsboll_NGT_prot2

% Simulate calcium - saline infusion
pca=[p_peak;p(17:23)];% calcium parameter
camod=casim(glu,pca);
% Simulate calcium - GIP infusion low dose (4 pmol/kg/min)
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;


% Simulate secretion - saline infusion
secmod=secsim_IE(p,camod,glu,Kglu);% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect

% Simulate secretion with the contribution of the incretin effect
% GIP infusion low dose (4 pmol/kg/min)
Kincr_glu.t=Kincr.t;
Kincr_glu.v=Kincr.v.*Kglu.v; % Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
secmod_IE=secsim_IE(p,camod_IE,glu,Kincr_glu);

% Calculate cpeptide 
[pcp,~,~]=vancau('ND','M',age,weight,height); 

% cpeptide - saline infusion
cpepmod=cpepsim(pcp,glu.t,secmod);
% cpeptide - GIP infusion low dose (4 pmol/kg/min)
cpepmod_IE=cpepsim(pcp,glu.t,secmod_IE); 




% Plot glucose, calcium, Kincr, secretion

figure()
subplot(4,1,1)
plot(glu.t,glu.v,'k')
setAxes(-10, 140, 4, '', 5, 20, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,'k',camod_IE.t,camod_IE.v,'b')
setAxes(-10, 140, 4, '', 50, 550, 6, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),'k',Kincr.t,Kincr.v,'b') 
setAxes(-10, 140, 4, '', 1, 3, 3, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,'k',secmod_IE.t,secmod_IE.v/BSA,'b') %  model secretion needs to be normalized to body surface
setAxes(-10, 140, 4, 'Time', ...
    0, 2500, 6, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout
legend('saline model','GIP model');
title('NGT')


%plot cpeptide
figure()
set(gcf,'position', [250 250 400 400]) 
pl=plot(cpep(1).t,cpep(1).v,'REPLACE_WITH_DASH_DASHk',cpepmod.t,cpepmod.v,'k',...
    cpep(2).t,cpep(2).v,'REPLACE_WITH_DASH_DASHb',cpepmod_IE.t,cpepmod_IE.v,'b');
xlabel('Time (min)','FontSize',16)
ylabel('C-peptide (pmol/L)','FontSize',16)
xlim([-10 120])
h=legend('saline data','saline model','GIP data','GIP model');
set(h,'Location','northwest')
title('NGT')

%% - Study B3: hiperglycemic clamp (HGC) with saline, GIP infusion at different doses or GLP1 infusion - T2D subjects
%
% Data from Vilsboll et al., 2002
clear all
close all
clc

% load data
load Vilsboll/Vilsboll_T2D_prot2


% Simulate calcium - saline infusion
pca=[p_peak;p(17:23)];% calcium parameter
camod=casim(glu,pca);
% Simulate calcium - GIP infusion low dose (4 pmol/kg/min), GIP infusion
% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)
camod_IE=struct('t',{},'v',{});
for k=1:3
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
end


% Simulate secretion - saline infusion
secmod=secsim_IE(p,camod,glu,Kglu);% Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect

% Simulate secretion with the contribution of the incretin effect
% GIP infusion low dose (4 pmol/kg/min), GIP infusion
% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)
Kincr_glu=struct('t',{},'v',{});
for k=1:3
    Kincr_glu(k).t=Kincr(k).t;
    Kincr_glu(k).v=Kincr(k).v.*Kglu.v; 
end     % Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
secmod_IE=struct('t',{},'v',{});
for k=1:3
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu,Kincr_glu(k));
end

% Calculate cpeptide 
[pcp,~,~]=vancau('T2D','M',age,weight,height); 

% cpeptide - saline infusion
cpepmod=cpepsim(pcp,glu.t,secmod);
% cpeptide - GIP infusion low dose (4 pmol/kg/min), GIP infusion
% high dose (16 pmol/kg/min), GLP1 infusion  (1 pmol/kg/min)
cpepmod_IE=struct('t',{},'v',{});
for k=1:3
    cpepmod_IE(k)=cpepsim(pcp,glu.t,secmod_IE(k)); 
end




% Plot glucose, calcium, Kincr, secretion
figure()
subplot(4,1,1)
plot(glu.t,glu.v,'k')
setAxes(-10, 190, 11, '', 5, 20, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,'k',camod_IE(1).t,camod_IE(1).v,'b',camod_IE(2).t,camod_IE(2).v,'g',camod_IE(3).t,camod_IE(3).v,'r')
setAxes(-10, 190, 11, '', 0, 400, 5, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),'k',Kincr(1).t,Kincr(1).v,'b',Kincr(2).t,Kincr(2).v,'g',Kincr(3).t,Kincr(3).v,'r') 
setAxes(-10, 190, 11, '', 1, 8, 8, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,'k',secmod_IE(1).t,secmod_IE(1).v/BSA,'b',secmod_IE(2).t,secmod_IE(2).v/BSA,'g',secmod_IE(3).t,secmod_IE(3).v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-10, 190, 11, 'Time (min)', ...
    0, 2500, 6, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout
legend('saline model','GIP model','GIP high model','GLP1 model')
title('T2D')


% plot cpeptide
figure()
set(gcf,'position', [250 250 400 400]) 
pl=plot(cpep(1).t,cpep(1).v,'REPLACE_WITH_DASH_DASHk',cpepmod.t,cpepmod.v,'k',...
    cpep(2).t,cpep(2).v,'REPLACE_WITH_DASH_DASHb',cpepmod_IE(1).t,cpepmod_IE(1).v,'b',...
    cpep(3).t,cpep(3).v,'REPLACE_WITH_DASH_DASHg',cpepmod_IE(2).t,cpepmod_IE(2).v,'g',...
    cpep(4).t,cpep(4).v,'REPLACE_WITH_DASH_DASHr',cpepmod_IE(3).t,cpepmod_IE(3).v,'r');
xlabel('Time (min)','FontSize',16)
ylabel('C-peptide (pmol/L)','FontSize',16)
xlim([-10 190])
h=legend('saline data','saline model','GIP data','GIP model','GIP high data','GIP high model',...
    'GLP1 data','GLP1 model');
set(h,'Location','northwest')
title('T2D')

%% - Study B4: hyperglicaemic clamp (HGC) with boluses and infusion of GIP at different doses - NGT subjects
%
% Data from Meier et al., 2004;
clear all
close all
clc

% load data
load Meier/Meier_NGT

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter
camod=casim(glu,pca);

% Add to calcium the transient increse due to the incretin effect
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;

% Simulate secretion with the contribution of the incretin effect 
Kincr_glu.t=Kincr.t;
Kincr_glu.v=Kincr.v.*Kglu.v;  % Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
secmod_IE=secsim_IE(p,camod_IE,glu,Kincr_glu); 

% Calculate cpeptide from secmod_IE
[pcp,~,~]=vancau('ND','M',age,weight,height); 
cpepmod_IE=cpepsim(pcp,glu.t,secmod_IE); 

% Plot glucose, calcium, Kincr, secretion, cpeptide


subplot(5,1,1)
plot(glu.t,glu.v,'k')
setAxes(-60, 180, 9, '', 5, 15, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(5,1,2)
plot(camod_IE.t,camod_IE.v,'b')
setAxes(-60, 180, 9, '', 0, 500, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(5,1,3)
plot(Kincr.t,Kincr.v,'b') 
setAxes(-60, 180, 9, '', 1, 4, 4, 'Kincr') % generate the figure with the proper layout
subplot(5,1,4)
plot(sec.t,sec.v/BSA,'k',secmod_IE.t,secmod_IE.v/BSA,'b') %  sec has been calculated through deconvolution from cpeptide data,...
% secretion needs to be normalized to body surface
setAxes(-60, 180, 9, '', ...
    0, 1300, 3, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout
subplot(5,1,5)
plot(cpep.t,cpep.v,'k',cpepmod_IE.t,cpepmod_IE.v,'b');
setAxes(-60, 180, 9, 'Time (min)', ...
    0, 3500, 3, 'C-peptide (pmol/L)') % generate the figure with the proper layout
legend('data','model')




%% - Study B4: hyperglicaemic clamp (HGC) with boluses and infusion of GIP at different doses - T2D subjects
%
% Data from Meier et al., 2004;
clear all
close all
clc

% load data
load Meier/Meier_T2D


% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter
camod=casim(glu,pca);

% Add to calcium the transient increse due to the incretin effect
camod_IE.t=camod.t;
camod_IE.v=camod.v+ca_transient.v;

% Simulate secretion with the contribution of the incretin effect 
Kincr_glu.t=Kincr.t;
Kincr_glu.v=Kincr.v.*Kglu.v;  % Kglu is the potentiating ...
% effect of glucose during HGC, independent from the incretin effect but that affects the ..
% refilling as the incretin effect
secmod_IE=secsim_IE(p,camod_IE,glu,Kincr_glu); 

% Calculate cpeptide from secmod_IE
[pcp,~,~]=vancau('ND','M',age,weight,height); 
cpepmod_IE=cpepsim(pcp,glu.t,secmod_IE); 

% Plot glucose, calcium, Kincr, secretion, cpeptide


subplot(5,1,1)
plot(glu.t,glu.v,'k')
setAxes(-60, 180, 9, '', 5, 15, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(5,1,2)
plot(camod_IE.t,camod_IE.v,'k')
setAxes(-60, 180, 9, '', 0, 500, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(5,1,3)
plot(Kincr.t,Kincr.v,'k') 
setAxes(-60, 180, 9, '', 1, 3, 3, 'Kincr') % generate the figure with the proper layout
subplot(5,1,4)
plot(sec.t,sec.v/BSA,'k',secmod_IE.t,secmod_IE.v/BSA,'b') %  sec has been calculated through deconvolution from cpeptide data,...
% secretion needs to be normalized to body surface
setAxes(-60, 180, 9, '', ...
    0, 500, 3, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout
subplot(5,1,5)
plot(cpep.t,cpep.v,'k',cpepmod_IE.t,cpepmod_IE.v,'b');
setAxes(-60, 180, 9, 'Time (min)', ...
    0, 1500, 3, 'C-peptide (pmol/L)') % generate the figure with the proper layout
legend('data','model')





%% - Study C1: glucose ramp with saline infusion or GLP1 infusion at different doses - NGT subjects
%
% Data from Kjems et al., 2003
clear all
close all
clc

% load data
load Kjems/Kjems_NGT

% Calculate calcium from glucose - saline infusion
pca=[p_peak;p(17:23)]; % calcium parameter
camod=casim(glu,pca);  % calcium with saline infusiomn
% Calculate calcium from glucose and GLP1 infusion
camod_IE=struct('t',{},'v',{}); % calcium with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)
for k=1:3
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
end


% Simulate secretion with saline infusion
secmod=secsim(p,camod,glu);
% Simulate secretion with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)
secmod_IE=secsim_IE(p,camod_IE(1),glu,Kincr(1),p,camod_IE(2),glu,Kincr(2),p,camod_IE(3),glu,Kincr(3));


% Calculate glucose sensitivity as reported in Fig. 6 of Kjems et al., 2003
gsmod.t=[0 0.5 1 2]; % GLP1 infusion doses
lin_reg=lreg(glu.v,secmod.v/BW);
gsmod.v(1)=lin_reg(1);
for k=1:3
    lin_reg=lreg(glu.v,secmod_IE(k).v/BW);
    gsmod.v(k+1)=lin_reg(1);
end

% Plot glucose, calcium, Kincr, secretion


subplot(4,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 180, 7, '', 4, 12, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,camod_IE(1).t,camod_IE(1).v,camod_IE(2).t,camod_IE(2).v,...
    camod_IE(3).t,camod_IE(3).v)
setAxes(-5, 180, 7, '', 50, 250, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),Kincr(1).t,Kincr(1).v,Kincr(2).t,Kincr(2).v,...
    Kincr(3).t,Kincr(3).v) 
setAxes(-5, 180, 7, '', 1, 12, 3, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BW,secmod_IE(1).t,secmod_IE(1).v/BW,secmod_IE(2).t,secmod_IE(2).v/BW,...
    secmod_IE(3).t,secmod_IE(3).v/BW) %  model secretion needs to be normalized to body weight
setAxes(-5, 180, 7, 'Time (min)', ...
    0, 40, 3, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout


% Figure 6 of Kjems et al., 2003 - NGT
figure()
set(gcf,'position', [250 250 400 400]) 
pl=plot(gsmod.t,gs,gsmod.t,gsmod.v,'REPLACE_WITH_DASH_DASHo');
xlabel('GLP1 (pmol kg^{-1} min^{-1})','FontSize',18)
ylabel('S vs G (pmol kg^{-1} min^{-1} / mmol L^{-1})','FontSize',18)
h=legend('NGT data','NGT model');
set(pl,'linewidth',2)
set(h,'Location','northwest')

%% - Study C1: glucose ramp with saline infusion or GLP1 infusion at different doses - T2D subjects
%
% Data from Kjems et al., 2003
clear all
close all
clc

% load data
load Kjems/Kjems_T2D


% Calculate calcium from glucose - saline infusion
pca=[p_peak;p(17:23)]; % calcium parameter
camod=casim(glu,pca);  % calcium with saline infusiomn
% Calculate calcium from glucose and GLP1 infusion
camod_IE=struct('t',{},'v',{}); % calcium with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)
for k=1:3
    camod_IE(k).t=camod.t;
    camod_IE(k).v=camod.v+ca_transient(k).v;
end


% Simulate secretion with saline infusion
secmod=secsim(p,camod,glu);
% Simulate secretion with the different GLP1 infusions (0.5,1 or 2 pmol/Kg/min)
secmod_IE=secsim_IE(p,camod_IE(1),glu,Kincr(1),p,camod_IE(2),glu,Kincr(2),p,camod_IE(3),glu,Kincr(3));

% Calculate glucose sensitivity as reported in Fig. 6 of Kjems et al., 2003
gsmod.t=[0 0.5 1 2]; % GLP1 infusion doses
lin_reg=lreg(glu.v,secmod.v/BW);
gsmod.v(1)=lin_reg(1);
for k=1:3
    lin_reg=lreg(glu.v,secmod_IE(k).v/BW);
    gsmod.v(k+1)=lin_reg(1);
end

% Plot glucose, calcium, Kincr, secretion


subplot(4,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 180, 7, '', 5, 15, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(4,1,2)
plot(camod.t,camod.v,camod_IE(1).t,camod_IE(1).v,camod_IE(2).t,camod_IE(2).v,...
    camod_IE(3).t,camod_IE(3).v)
setAxes(-5, 180, 7, '', 50, 250, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu.t,ones(1,numel(glu.t)),Kincr(1).t,Kincr(1).v,Kincr(2).t,Kincr(2).v,...
    Kincr(3).t,Kincr(3).v) 
setAxes(-5, 180, 7, '', 1, 8, 3, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BW,secmod_IE(1).t,secmod_IE(1).v/BW,secmod_IE(2).t,secmod_IE(2).v/BW,...
    secmod_IE(3).t,secmod_IE(3).v/BW) %  model secretion needs to be normalized to body weight
setAxes(-5, 180, 7, 'Time (min)', ...
    0, 40, 3, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout

% Figure 6 of Kjems et al., 2003 - T2D
figure()
set(gcf,'position', [250 250 400 400]) 
pl=plot(gsmod.t,gs,gsmod.t,gsmod.v,'REPLACE_WITH_DASH_DASHo');
xlabel('GLP1 (pmol kg^{-1} min^{-1})','FontSize',18)
ylabel('S vs G (pmol kg^{-1} min^{-1} / mmol L^{-1})','FontSize',18)
h=legend('T2D data','T2D model');
set(pl,'linewidth',2)
set(h,'Location','northwest')



%% - Study D1: OGTT and Intravenous glucose infusion simulating an OGTT with saline, GIP or GLP1 infusion - NGT subjects
%
% Data from Nauck et al., JCEM 1993
clear all
close all
clc

% load data
load NauckJCEM/NauckJCEM


% Simulate calcium - OGTT IV
pca=[p_peak;p(17:23)];% calcium parameter
camod=casim(glu(1),pca);
% Simulate calcium - OGTT,OGTT IV + GIP infusion, GLP1 infusion, GIP and GLP1 infusion 
camod_IE=struct('t',{},'v',{});
catmp=struct('t',{},'v',{});
for k=1:4
    catmp(k)=casim(glu(k+1),pca);
    camod_IE(k).t=catmp(k).t;
    camod_IE(k).v=catmp(k).v+ca_transient(k).v;
end

% Simulate secretion - OGTT IV
secmod=secsim(p,camod,glu(1));

% Simulate secretion - OGTT, OGTT IV + GIP infusion, GLP1 infusion, GIP and GLP1 infusion 
secmod_IE=struct('t',{},'v',{});
for k=1:4
    secmod_IE(k)=secsim_IE(p,camod_IE(k),glu(k+1),Kincr(k));
end


% Calculate cpeptide 
[pcp,~,~]=vancau('ND','M',age,weight,height); 

% cpeptide - OGTT IV
cpepmod=cpepsim(pcp,glu(1).t,secmod);
% cpeptide - OGTT and OGTT IV + GIP infusion, GLP1 infusion, GIPA and GLP1 infusion 
cpepmod_IE=struct('t',{},'v',{});
for k=1:4
    cpepmod_IE(k)=cpepsim(pcp,glu(k+1).t,secmod_IE(k)); 
end
%%
% Plot glucose, calcium, Kincr, secretion - OGTT-like


subplot(4,1,1)
plot(glu(1).t,glu(1).v,'k')
setAxes(-30, 220, 6, '', 5, 15, 3, 'G (mmol/L)') % generate the figure with the proper layout
title('OGTT like')
subplot(4,1,2)
plot(camod.t,camod.v,'k')
setAxes(-30, 220, 6, '', 50, 250, 5, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(glu(1).t,ones(1,numel(glu(1).t)),'k')
setAxes(-30, 220, 6, '', 0.5, 1.5, 3, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod.t,secmod.v/BSA,'k') %  model secretion needs to be normalized to body surface
setAxes(-30, 220, 6, 'Time (min)', ...
    0, 500, 3, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout

titles={'OGTT' 'GIP infusion' 'GLP-1 infusion' 'GIP and GLP-1 infusion'};
%%

 

figure()
for k=1:4
subplot(4,1,1)
plot(glu(k+1).t,glu(k+1).v,'k')
setAxes(-30, 220, 6, '', 5, 15, 3, 'G (mmol/L)') % generate the figure with the proper layout
title(sprintf(titles{k}))
subplot(4,1,2)
plot(camod_IE(k).t,camod_IE(k).v,'k')
setAxes(-30, 220, 6, '', 50, 250, 5, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(4,1,3)
plot(Kincr(k).t,Kincr(k).v,'k') 
setAxes(-30, 220, 6, '', 1, 5, 5, 'Kincr') % generate the figure with the proper layout
subplot(4,1,4)
plot(secmod_IE(k).t,secmod_IE(k).v/BSA,'k') %  model secretion needs to be normalized to body surface
setAxes(-30, 220, 6, 'Time (min)', ...
    0, 800, 5, 'S (pmol Kg min^{-1})') % generate the figure with the proper layout
end   

% Plot cpeptide
figure()
plot(cpep(1).t,cpep(1).v,'REPLACE_WITH_DASH_DASHk',cpepmod.t,cpepmod.v,'k',...
    cpep(2).t,cpep(2).v,'REPLACE_WITH_DASH_DASHg',cpepmod_IE(1).t,cpepmod_IE(1).v,'-g');
setAxes(-30, 220, 6, 'Time (min)', ...
    0, 4000, 5, 'C-peptide (pmol/L)') % generate the figure with the proper layout
legend('OGTT IV data','OGTT IV model','OGTT data','OGTT model')


figure()
plot(cpep(3).t,cpep(3).v,'REPLACE_WITH_DASH_DASHb',cpepmod_IE(2).t,cpepmod_IE(2).v,'b',...
    cpep(4).t,cpep(4).v,'REPLACE_WITH_DASH_DASHr',cpepmod_IE(3).t,cpepmod_IE(3).v,'-r',...
     cpep(5).t,cpep(5).v,'REPLACE_WITH_DASH_DASHm',cpepmod_IE(4).t,cpepmod_IE(4).v,'-m');
setAxes(-30, 220, 6, 'Time (min)', ...
    0, 4000, 5, 'C-peptide (pmol/L)') % generate the figure with the proper layout
legend('GIP data','GIP model','GLP1 data','GLP1 model','GIP and GLP1 data','GIP and GLP1 model')



%% Data analysis
%
% For each test we created a vector containing 6 elements:
% - element 1 of the vector: GIP or GLP1 infusion rate (pmol/kg/min)
% - element 2 of the vector GIP or GLP1 basal concentration (pmol/L) - total GIP or GLP1
% - element 3 of the vector: AUC Kincr
% - element 4 of the vector: AUC calcium transient due to the incretin effect (nmol/L)
% - element 5 of the vector: AUC glu during the incretins stimulus (mmol/L)
% - element 6 of the vecotr: AUC of GIP or GLP1 concentration (pmol/L) - total GIP or GLP1
% The vectors are saved in the file analysis_all_tests


% Element 2 and element 6 of the vectors referring to Nauck JCI and Nauck
% JCEM studies are already rescaled as described in the methods part of the
% article of Grespan et al. 2019

clear all
close all
clc
load analysis_all_tests



% plot GIP and GLP1 concentration vs Kincr calculated by the model for all
% the diffferent tests
load Kincrmod

figure()
subplot(1,2,1) 
p1=plot(test_GIP_NGT_Meier(:,6),test_GIP_NGT_Meier(:,3),'ob',...
    test_GIP_NGT_Honka(:,6),test_GIP_NGT_Honka(:,3),'sb',...
    test_GIP_NGT_Hojberg(:,6),test_GIP_NGT_Hojberg(:,3),'^b',...
    test_GIP_NGT_Vilsboll(:,6),test_GIP_NGT_Vilsboll(:,3),'*b',...
    test_GIP_NGT_NauckJCI(:,6),test_GIP_NGT_NauckJCI(:,3),'xb',...
    test_GIP_NGT_NauckJCEM(:,6),test_GIP_NGT_NauckJCEM(:,3),'+b',...
    test_GIP_GIPANDGLP1_NGT_NauckJCEM(:,6),test_GIP_GIPANDGLP1_NGT_NauckJCEM(:,3),'+b',...
    Kincrmod_GIP_NGT(1).t,Kincrmod_GIP_NGT(1).v,'-b',...
    test_GLP1_NGT_Honka(:,6),test_GLP1_NGT_Honka(:,3),'sr',...
    test_GLP1_NGT_Kjems(:,6),test_GLP1_NGT_Kjems(:,3),'dr',...
    test_GLP1_NGT_Hojberg(:,6),test_GLP1_NGT_Hojberg(:,3),'^r',...
    test_GLP1_NGT_NauckJCI(:,6),test_GLP1_NGT_NauckJCI(:,3),'xr',...
    test_GLP1_NGT_NauckJCEM(:,6),test_GLP1_NGT_NauckJCEM(:,3),'+r',...
    test_GLP1_GIPANDGLP1_NGT_NauckJCEM(:,6),test_GLP1_GIPANDGLP1_NGT_NauckJCEM(:,3),'+r',...
    Kincrmod_GLP1_NGT(1).t,Kincrmod_GLP1_NGT(1).v,'-r');  
xlim([0 500])
ylim([1 10])
xlabel('Total hormone concentration (pmol/L)')
ylabel('Incretin potentiation of ISR (k_{incr})')
set(p1,'linewidth',2)
set(gca,'FontSize',14)
title('NGT')

subplot(1,2,2)
p1=plot(test_GIP_T2D_Mentis(:,6),test_GIP_T2D_Mentis(:,3),'vb',...
    test_GIP_T2D_Meier(:,6),test_GIP_T2D_Meier(:,3),'ob',...
    test_GIP_T2Dpre_Hojberg(:,6),test_GIP_T2Dpre_Hojberg(:,3),'^b',...
    test_GIP_T2D_Vilsboll(:,6),test_GIP_T2D_Vilsboll(:,3),'*b',...
    test_GIP_T2D_NauckJCI(:,6),test_GIP_T2D_NauckJCI(:,3),'xb',...
    Kincrmod_GIP_T2D.t,Kincrmod_GIP_T2D.v,'-b',...
    test_GLP1_T2D_Mentis(:,6),test_GLP1_T2D_Mentis(:,3),'vr',...
    test_GLP1_T2D_Kjems(:,6),test_GLP1_T2D_Kjems(:,3),'dr',...
    test_GLP1_T2Dpre_Hojberg(:,6),test_GLP1_T2Dpre_Hojberg(:,3),'^r',...
    test_GLP1_T2D_Vilsboll(:,6),test_GLP1_T2D_Vilsboll(:,3),'*r',...
    test_GLP1_T2D_NauckJCI(:,6),test_GLP1_T2D_NauckJCI(:,3),'xr',...
    Kincrmod_GLP1_T2D.t,Kincrmod_GLP1_T2D.v,'-r'); 
xlim([0 500])
ylim([1 10])
%set(gca,'xTick',[0 1 2 3 4 8 12 16])
xlabel('Total hormone concentration (pmol/L)')
ylabel('Incretin potentiation of ISR (k_{incr})')
set(p1,'linewidth',2)
set(gca,'FontSize',14)
title('T2D')



% plot hormone-Kincr relationship used to simulate Study D1
figure()
p1=plot(Kincrmod_GIP_NGT(2).t,Kincrmod_GIP_NGT(2).v,'-b',...
    Kincrmod_GLP1_NGT(2).t,Kincrmod_GLP1_NGT(2).v,'-r');
xlim([0 400])
ylim([1 10])
xlabel('Total hormone concentration (pmol/L)')
ylabel('Incretin potentiation of ISR (k_{incr})')
set(p1,'linewidth',2)
set(gca,'FontSize',14)
title('NGT')
##### SOURCE END #####
--></body></html>